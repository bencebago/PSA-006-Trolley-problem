---
title: "Supplementary materials"
author: "Bence Bago"
date: "14 January 2021"
output:
  rmarkdown::pdf_document:
    extra_dependencies: ["float"]
    fig_caption: yes        
header-includes: 
  \usepackage{float} \floatplacement{figure}{H} 
  \newcommand{\beginsupplement}{\setcounter{table}{0}  \renewcommand{\thetable}{S\arabic{table}} \setcounter{figure}{0} \renewcommand{\thefigure}{S\arabic{figure}}}
editor_options: 
  chunk_output_type: console
---

\beginsupplement
```{r setup, echo=FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}
library(BayesFactor)
library(reshape2)
library(ggplot2)
library(kableExtra)
<<<<<<< HEAD
=======
library(lmerTest)

>>>>>>> 63c799860db068f808a3109a2c9024c9d18a1f40
library(tidyverse)
library(jsonlite)
library(lubridate)
library(vroom)
library(countrycode)
library(gt)
library(janitor)

setwd('C:/Users/Bence/Documents/PSA-006-Trolley-problem')

trolley_raw <- vroom("data/trolley_raw.csv")

# Correct answers for attention check for the tasks
correct_answers_1 <- read_csv("meta_data/correct_answers_1.csv")
correct_answers_2 <- read_csv("meta_data/correct_answers_2.csv")

# Remove all trial runs and incomplete surveys
trolley_proc <-
  trolley_raw %>% 
  # Aggregate randomization variables
  mutate(scenario1 = case_when(FL_24_DO_Footbridgepole == 1 ~ "Pole",
                               FL_24_DO_Footbridgeswitch == 1 ~ "Switch",
                               TRUE ~ NA_character_),
         scenario2 = case_when(FL_22_DO_Standardswitch == 1 ~ "Standardswitch",
                               FL_22_DO_Standardfootbridge == 1 ~ "Standardfootbridge",
                               FL_22_DO_Loop == 1 ~ "Loop",
                               FL_22_DO_Obstaclecollide == 1 ~ "Obstaclecollide",
                               TRUE ~ NA_character_)) %>% 
  # Remove those who didn't finish the questionnaire
  filter(Progress >= 98) %>% 
  # Remove all practice runs
  filter(str_detect(str_to_lower(practice), "false")) %>% 
  # Remove the answers for a particular lab that has unflagged practice data
  filter(!(lab == "TUR_021" & StartDate < date("2020-04-22")),
         !(lab == "AUT_003" & StartDate < date("2020-06-18")),
         !(lab == "USA_095"))

# write_csv(trolley_proc, "data/trolley_preprocessed.csv")

# Exclude participants specified in the preregistration
trolley <-
  trolley_proc %>% 
  # Exclude careless responders
  filter_at(vars(careless_1, careless_2), all_vars(. != 1)) %>%
  filter(careless_3 != 2) %>%
  # Remove confused participants 
  filter(confusion != 3) %>%
  # Exclude those with familiarity of the topic
  filter(familiarity <= 3) %>%
  # Technical problems is not in the master questionnaire!
  filter(technical_problems != 2) %>% 
  # Exclude those who did not fill the questionnaire on their native language
  filter(native_language != 2)

# Remove those who can't tell which scenarios they saw
# Use the correct answer descriptions as attention check for the tasks
# Only those are kept who answered either of the tasks correctly

study1a <- 
  trolley %>%
  left_join(correct_answers_1, by = "scenario1") %>% 
  filter(trolley_attention == trolley_answer) %>%
  select(-trolley_answer, -speedboat_answer)

study1b <- 
  trolley %>% 
  left_join(correct_answers_1, by = "scenario1") %>% 
  filter(speedboat_attention == speedboat_answer) %>%
  select(-trolley_answer, -speedboat_answer)

study2a <-
  trolley %>% 
  left_join(correct_answers_2, by = "scenario2") %>% 
  filter(trolley_attention == trolley_answer) %>%
  select(-trolley_answer, -speedboat_answer)

study2b <-
  trolley %>% 
  left_join(correct_answers_2, by = "scenario2") %>% 
  filter(speedboat_attention == speedboat_answer) %>%
  select(-trolley_answer, -speedboat_answer)
```

```{r individualism score, echo=FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}

cd_raw <- read_csv(here::here("data/collectivism_similarity_matrix-from_culturaldistance.com.csv"))

cd <- 
  cd_raw %>% 
  transmute(country = names(.),
            Collectivism = `United States2010-2014`) %>% 
  extract(country, 
          into = c("Country", "distance_year"), 
          regex = "(.*)(\\d{4}-\\d{4})") %>% 
  # Get the latest similarity data
  group_by(Country) %>% 
  slice_tail(n = 1) %>% 
  ungroup() %>% 
  # USA should have 0 distance (not NA)
  mutate(Collectivism = if_else(is.na(Collectivism), 0, Collectivism),
         country3 = countryname(sourcevar = Country, 
                                destination = "iso3c")) 

trolley_proc$lab=as.character(trolley_proc$lab)
trolley_proc$country3=sub("^([A-z]+)_([0-9]+)$", "\\1",  trolley_proc$lab)
trolley_proc$country3=recode(trolley_proc$country3,SWT="CHE", LEB = "LBN", BUL = "BGR", SPA = "ESP")
trolley_proc=merge(trolley_proc, cd, by=c("country3"))

###individualism/collectivism scale
attach(trolley_proc)
trolley_proc$hor_ind=rowMeans(cbind(individualism_scale_1, individualism_scale_2,individualism_scale_3,individualism_scale_4))
trolley_proc$ver_ind=rowMeans(cbind(individualism_scale_5, individualism_scale_6,individualism_scale_7,individualism_scale_8))
trolley_proc$hor_col=rowMeans(cbind(individualism_scale_9, individualism_scale_10,individualism_scale_11,individualism_scale_12))
trolley_proc$ver_col=rowMeans(cbind(individualism_scale_13, individualism_scale_14,individualism_scale_15,individualism_scale_16))
detach(trolley_proc)

survey=levels(factor(trolley_proc$survey_name))

```

#1. Demographics and exclusion 

<!-- <Tamas> -->


#2. Main replication analysis

##Study 1a

###Bayesian analysis


```{r Study1a Bayesian, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

#use data study1a
tabledata_s1a = data.frame(Exclusion=c(rep("Exclusion",3)),Cluster=c("Eastern", "Southern", "Western"), matrix(nrow=3, ncol=5, dimnames=list(survey,c("BF","RR", "t", "df", "p"))))

for (i in survey){
dat=subset(study1a, survey_name==i, select=c("trolley_1_rate", "trolley_2_rate"))
dat_long=na.omit(melt(data=dat, variable.name = "condition", value.name="rate"))
datt=as_tibble(ttestBF(formula = rate ~ condition, data=dat_long, rscale=0.26, nullInterval = c(0, Inf)))
tabledata_s1a[i, "BF"]=signif(round(as.numeric(datt[2,1]),1),2)
frequentist=t.test(rate ~ condition, data=dat_long)
tabledata_s1a[i, "t"]=round(frequentist$statistic,2)
tabledata_s1a[i, "df"]=round(frequentist$parameter,2)
tabledata_s1a[i, "p"]=round(frequentist$p.value,4)
}

tabledata_s1a_ne = data.frame(Exclusion=c(rep("No exclusion",3)),Cluster=c("Eastern", "Southern", "Western"), matrix(nrow=3, ncol=5, dimnames=list(survey,c("BF","RR", "t", "df", "p"))))
for (i in survey){
dat=subset(trolley_proc, survey_name==i, select=c("trolley_1_rate", "trolley_2_rate"))
dat_long=na.omit(melt(data=dat, variable.name = "condition", value.name="rate"))
datt=as_tibble(ttestBF(formula = rate ~ condition, data=dat_long, rscale=0.26, nullInterval = c(0, Inf)))
tabledata_s1a_ne[i, "BF"]=signif(round(as.numeric(datt[2,1]),1),2)
frequentist=t.test(rate ~ condition, data=dat_long)
tabledata_s1a_ne[i, "t"]=round(frequentist$statistic,2)
tabledata_s1a_ne[i, "df"]=round(frequentist$parameter,2)
tabledata_s1a_ne[i, "p"]=round(frequentist$p.value,4)
}
studys1a_results = rbind(tabledata_s1a, tabledata_s1a_ne)
rownames(studys1a_results) <- NULL
studys1a_results[,"p"]<-"<.001"

studys1a_results[,"RR"]<-c("1.5e-02, 4.7e+01", "3.0e-08, 9.0e+06", "4.0e-0.3, 1.4e+01", "8.0e-15, 2.0e+13", "1.0e-23, 1.9e+22", "2.0e-19, 6.0e+17")

kbl(
  studys1a_results,
  format = "latex",
  booktabs = T,
  escape=T,
  caption = "Do personal force have an effect on moral dilemma judgements on Trolley dilemmas?",
  centering=T,
  position="H"
  )%>%
  kable_styling( full_width = F,  position="left")%>%
  row_spec(row=0, bold=TRUE)%>%
  collapse_rows(columns = 1, valign = "top", latex_hline = "major", row_group_label_position = "identity")

```




<!-- //graph with exclusion -->
```{r Study1a excl graph, fig.pos="H",out.width="90%",fig.cap="Results on Trolley dilemmas in Study 1 when all exclusions criteria are applied. Black points are group level averages. There is an effect of personal force on each of the three clusters.", echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE }

full=subset(study1a, select=c("trolley_1_rate", "trolley_2_rate", "survey_name"))
full$survey_name=factor(full$survey_name)
full2=melt(data=full, variable.name = "condition", value.name="rate", id="survey_name")
full2$condition=plyr::mapvalues(full2$condition, from=c("trolley_1_rate", "trolley_2_rate"), to=c("Personal Force", "No personal force"))
full2$survey_name=plyr::mapvalues(full2$survey_name, from=c("PSA006_Eastern", "PSA006_Western", "PSA006_Southern"), to=c("Eastern", "Western", "Southern"))
full2=na.omit(full2)

source("https://gist.githubusercontent.com/benmarwick/2a1bb0133ff568cbe28d/raw/fb53bd97121f7f9ce947837ef1a4c65a73bffb3f/geom_flat_violin.R")
lb <- function(x) mean(x, na.rm=T) - sd(x, na.rm=T)
ub <- function(x) mean(x, na.rm=T) + sd(x, na.rm=T)

sumld<- plyr::ddply(full2, ~condition+survey_name, summarise, mean = mean(rate, na.rm=T), median = median(rate, na.rm=T), lower = lb(rate), upper = ub(rate))

ggplot(full2, aes(x=condition, y=rate, fill=condition)) +
  geom_flat_violin(position = position_nudge(x = .2, y = 0), alpha = .8)+
  geom_point(aes(y = rate, color = condition), position = position_jitter(width = .15), size = .5, alpha = 0.8) +
  stat_summary(fun=mean,geom="line", aes(group=1),position = position_nudge(x = 0.3), size = 1)+
  geom_line(data = sumld, aes(x = condition, y = mean), position = position_nudge(x = 0.3), size = 2.5)+
  geom_point(data = sumld, aes(x = condition, y = mean), position = position_nudge(x = 0.3), size = 2.5) +
  #geom_errorbar(data = sumld, aes(ymin = lower, ymax = upper, y = mean), position = position_nudge(x = 0.3), width = 0) +
  guides(fill = FALSE) +
  guides(color = FALSE) +
  facet_wrap(facets=vars(survey_name)) +
  labs( y="To what extent is this action morally acceptable?")+ theme_bw()+
  expand_limits(y=c(1,9))+scale_y_continuous(breaks=c(1,2,3,4,5,6,7,8,9))+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.x=element_blank(), axis.title.y=element_text(face="bold", size=10), axis.text.x = element_text(face="bold", size=7, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_blank(),legend.text=element_text(size=9))

```


<!-- //graph without exclusion -->
```{r Study1a w/o excl graph, fig.pos="H",out.width="90%",fig.cap="Results on Trolley dilemmas in Study 1 when no exclusions criteria is applied. Black points are group level averages.  There is an effect of personal force on each of the three clusters.", echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE }

full=subset(trolley_proc, select=c("trolley_1_rate", "trolley_2_rate", "survey_name"))
full$survey_name=factor(full$survey_name)
full2=melt(data=full, variable.name = "condition", value.name="rate", id="survey_name")
full2$condition=plyr::mapvalues(full2$condition, from=c("trolley_1_rate", "trolley_2_rate"), to=c("Personal Force", "No personal force"))
full2$survey_name=plyr::mapvalues(full2$survey_name, from=c("PSA006_Eastern", "PSA006_Western", "PSA006_Southern"), to=c("Eastern", "Western", "Southern"))
full2=na.omit(full2)

source("https://gist.githubusercontent.com/benmarwick/2a1bb0133ff568cbe28d/raw/fb53bd97121f7f9ce947837ef1a4c65a73bffb3f/geom_flat_violin.R")
lb <- function(x) mean(x, na.rm=T) - sd(x, na.rm=T)
ub <- function(x) mean(x, na.rm=T) + sd(x, na.rm=T)

sumld<- plyr::ddply(full2, ~condition+survey_name, summarise, mean = mean(rate, na.rm=T), median = median(rate, na.rm=T), lower = lb(rate), upper = ub(rate))

ggplot(full2, aes(x=condition, y=rate, fill=condition)) +
  geom_flat_violin(position = position_nudge(x = .2, y = 0), alpha = .8)+
  geom_point(aes(y = rate, color = condition), position = position_jitter(width = .15), size = .5, alpha = 0.8) +
  stat_summary(fun=mean,geom="line", aes(group=1),position = position_nudge(x = 0.3), size = 1)+
  geom_line(data = sumld, aes(x = condition, y = mean), position = position_nudge(x = 0.3), size = 2.5)+
  geom_point(data = sumld, aes(x = condition, y = mean), position = position_nudge(x = 0.3), size = 2.5) +
  guides(fill = FALSE) +
  guides(color = FALSE) +
  facet_wrap(facets=vars(survey_name)) +
  labs( y="To what extent is this action morally acceptable?")+ theme_bw()+
  expand_limits(y=c(1,9))+scale_y_continuous(breaks=c(1,2,3,4,5,6,7,8,9))+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.x=element_blank(), axis.title.y=element_text(face="bold", size=10), axis.text.x = element_text(face="bold", size=7, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_blank(),legend.text=element_text(size=9))

```


##Study 1b

```{r Study1b Bayesian, echo=FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}


survey=levels(factor(trolley_proc$survey_name))
tabledata_s1b = data.frame(Exclusion=c(rep("Exclusion",3)),Cluster=c("Eastern", "Southern", "Western"), matrix(nrow=3, ncol=5, dimnames=list(survey,c("BF","RR", "t", "df", "p"))))

for (i in survey){
dat=subset(study1b, survey_name==i, select=c("speedboat_1_rate", "speedboat_2_rate"))
dat_long=na.omit(melt(data=dat, variable.name = "condition", value.name="rate"))
datt=as_tibble(ttestBF(formula = rate ~ condition, data=dat_long, rscale=0.26, nullInterval = c(0, Inf)))
tabledata_s1b[i, "BF"]=signif(round(as.numeric(datt[2,1]),1),2)
frequentist=t.test(rate ~ condition, data=dat_long)
tabledata_s1b[i, "t"]=round(frequentist$statistic,2)
tabledata_s1b[i, "df"]=round(frequentist$parameter,2)
tabledata_s1b[i, "p"]=round(frequentist$p.value,3)
}

tabledata_s1b_ne = data.frame(Exclusion=c(rep("No exclusion",3)),Cluster=c("Eastern", "Southern", "Western"), matrix(nrow=3, ncol=5, dimnames=list(survey,c("BF","RR", "t", "df", "p"))))
for (i in survey){
dat=subset(trolley_proc, survey_name==i, select=c("speedboat_1_rate", "speedboat_2_rate"))
dat_long=na.omit(melt(data=dat, variable.name = "condition", value.name="rate"))
datt=as_tibble(ttestBF(formula = rate ~ condition, data=dat_long, rscale=0.26, nullInterval = c(0, Inf)))
tabledata_s1b_ne[i, "BF"]=signif(round(as.numeric(datt[2,1]),1),2)
frequentist=t.test(rate ~ condition, data=dat_long)
tabledata_s1b_ne[i, "t"]=round(frequentist$statistic,2)
tabledata_s1b_ne[i, "df"]=round(frequentist$parameter,2)
tabledata_s1b_ne[i, "p"]=round(frequentist$p.value,3)
}
studys1b_results = rbind(tabledata_s1b, tabledata_s1b_ne)
rownames(studys1b_results) <- NULL
studys1b_results[studys1b_results==0.000]<-"<.001"

studys1b_results[,"RR"]<-c("2.6e-06, 5.7e+04", "3.0e-04, 2.5e+03", "6.0e-03, 4.3", "8.4e-10, 1.1e+08", "5.8e-18, 2.2e+16", "8.0e-18, 1.2e+16")

kbl(
  studys1b_results,
  format = "latex",
  booktabs = T,
  escape=T,
  caption = "Do personal force have an effect on moral dilemma judgements on Speedboat dilemmas?",
  centering=T,
  position="H"
  )%>%
  kable_styling( full_width = F,  position="left")%>%
  row_spec(row=0, bold=TRUE)%>%
  collapse_rows(columns = 1, valign = "top", latex_hline = "major", row_group_label_position = "identity")
```


<!-- //graph with exclusion -->
```{r Study1b excl graph, fig.pos="H",out.width="90%",fig.cap="Results on Speedboat dilemmas in Study 1 when all exclusions criteria are applied. Black points are group level averages.  There is an effect of personal force on each of the three clusters.", echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE }

full=subset(study1b, select=c("speedboat_1_rate", "speedboat_2_rate", "survey_name"))
full$survey_name=factor(full$survey_name)
full2=melt(data=full, variable.name = "condition", value.name="rate", id="survey_name")
full2$condition=plyr::mapvalues(full2$condition, from=c("speedboat_1_rate", "speedboat_2_rate"), to=c("Personal Force", "No personal force"))
full2$survey_name=plyr::mapvalues(full2$survey_name, from=c("PSA006_Eastern", "PSA006_Western", "PSA006_Southern"), to=c("Eastern", "Western", "Southern"))
full2=na.omit(full2)

source("https://gist.githubusercontent.com/benmarwick/2a1bb0133ff568cbe28d/raw/fb53bd97121f7f9ce947837ef1a4c65a73bffb3f/geom_flat_violin.R")
lb <- function(x) mean(x, na.rm=T) - sd(x, na.rm=T)
ub <- function(x) mean(x, na.rm=T) + sd(x, na.rm=T)

sumld<- plyr::ddply(full2, ~condition+survey_name, summarise, mean = mean(rate, na.rm=T), median = median(rate, na.rm=T), lower = lb(rate), upper = ub(rate))

ggplot(full2, aes(x=condition, y=rate, fill=condition)) +
  geom_flat_violin(position = position_nudge(x = .2, y = 0), alpha = .8)+
  geom_point(aes(y = rate, color = condition), position = position_jitter(width = .15), size = .5, alpha = 0.8) +
  stat_summary(fun=mean,geom="line", aes(group=1),position = position_nudge(x = 0.3), size = 1)+
  geom_line(data = sumld, aes(x = condition, y = mean), position = position_nudge(x = 0.3), size = 2.5)+
  geom_point(data = sumld, aes(x = condition, y = mean), position = position_nudge(x = 0.3), size = 2.5) +
  #geom_errorbar(data = sumld, aes(ymin = lower, ymax = upper, y = mean), position = position_nudge(x = 0.3), width = 0) +
  guides(fill = FALSE) +
  guides(color = FALSE) +
  facet_wrap(facets=vars(survey_name)) +
  labs( y="To what extent is this action morally acceptable?")+ theme_bw()+
  expand_limits(y=c(1,9))+scale_y_continuous(breaks=c(1,2,3,4,5,6,7,8,9))+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.x=element_blank(), axis.title.y=element_text(face="bold", size=10), axis.text.x = element_text(face="bold", size=7, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_blank(),legend.text=element_text(size=9))

```


<!-- //graph without exclusion -->
```{r Study1b w/o excl graph, fig.pos="H",out.width="90%",fig.cap="Results on Speedboat dilemmas in Study 1 when no exclusions criteria is applied. Black points are group level averages.  There is an effect of personal force on each of the three clusters.", echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE }

full=subset(trolley_proc, select=c("speedboat_1_rate", "speedboat_2_rate", "survey_name"))
full$survey_name=factor(full$survey_name)
full2=melt(data=full, variable.name = "condition", value.name="rate", id="survey_name")
full2$condition=plyr::mapvalues(full2$condition, from=c("speedboat_1_rate", "speedboat_2_rate"), to=c("Personal Force", "No personal force"))
full2$survey_name=plyr::mapvalues(full2$survey_name, from=c("PSA006_Eastern", "PSA006_Western", "PSA006_Southern"), to=c("Eastern", "Western", "Southern"))
full2=na.omit(full2)

source("https://gist.githubusercontent.com/benmarwick/2a1bb0133ff568cbe28d/raw/fb53bd97121f7f9ce947837ef1a4c65a73bffb3f/geom_flat_violin.R")
lb <- function(x) mean(x, na.rm=T) - sd(x, na.rm=T)
ub <- function(x) mean(x, na.rm=T) + sd(x, na.rm=T)

sumld<- plyr::ddply(full2, ~condition+survey_name, summarise, mean = mean(rate, na.rm=T), median = median(rate, na.rm=T), lower = lb(rate), upper = ub(rate))

ggplot(full2, aes(x=condition, y=rate, fill=condition)) +
  geom_flat_violin(position = position_nudge(x = .2, y = 0), alpha = .8)+
  geom_point(aes(y = rate, color = condition), position = position_jitter(width = .15), size = .5, alpha = 0.8) +
  stat_summary(fun=mean,geom="line", aes(group=1),position = position_nudge(x = 0.3), size = 1)+
  geom_line(data = sumld, aes(x = condition, y = mean), position = position_nudge(x = 0.3), size = 2.5)+
  geom_point(data = sumld, aes(x = condition, y = mean), position = position_nudge(x = 0.3), size = 2.5) +
  #geom_errorbar(data = sumld, aes(ymin = lower, ymax = upper, y = mean), position = position_nudge(x = 0.3), width = 0) +
  guides(fill = FALSE) +
  guides(color = FALSE) +
  facet_wrap(facets=vars(survey_name)) +
  labs( y="To what extent is this action morally acceptable?")+ theme_bw()+
  expand_limits(y=c(1,9))+scale_y_continuous(breaks=c(1,2,3,4,5,6,7,8,9))+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.x=element_blank(), axis.title.y=element_text(face="bold", size=10), axis.text.x = element_text(face="bold", size=7, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_blank(),legend.text=element_text(size=9))

```


##Study 2a

```{r Study2a Bayesian, echo=FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}

tabledata_s2a = data.frame(Exclusion=c(rep("Exclusion",3)),Cluster=c("Eastern", "Southern", "Western"), matrix(nrow=3, ncol=5, dimnames=list(survey,c("BF","RR", "F", "df", "p"))))

for (i in survey){
dat=subset(study2a, survey_name==i, select=c("trolley_3_rate", "trolley_4_rate", "trolley_5_rate", "trolley_6_rate"))
dat_long=na.omit(melt(data=dat, variable.name = "condition", value.name="rate"))
dat_long$personal_force = factor(ifelse(dat_long$condition=="trolley_3_rate"|dat_long$condition=="trolley_5_rate", 0, 1))
dat_long$intention = factor(ifelse(dat_long$condition=="trolley_4_rate"|dat_long$condition=="trolley_5_rate", 1, 0))
datt=lmBF(rate ~ personal_force*intention, data=dat_long, rscaleFixed=0.26)
datt2=lmBF(rate ~ personal_force+intention, data=dat_long, rscaleFixed=0.26)
datt3=as_tibble(datt/datt2)
tabledata_s2a[i, "BF"]=signif(round(datt3[1,1],1),2)
frequentist=summary(aov(rate ~ personal_force*intention, data=dat_long))[[1]]
tabledata_s2a[i, "F"]=round(frequentist[3, "F value"],3)
tabledata_s2a[i, "df"]=paste("1, ", frequentist[4, "Df"])
tabledata_s2a[i, "p"]=round(frequentist[3, "Pr(>F)"],3)
}

tabledata_s2a_ne = data.frame(Exclusion=c(rep("No exclusion",3)),Cluster=c("Eastern", "Southern", "Western"), matrix(nrow=3, ncol=5, dimnames=list(survey,c("BF","RR", "F", "df", "p"))))
for (i in survey){
dat=subset(trolley_proc, survey_name==i, select=c("trolley_3_rate", "trolley_4_rate", "trolley_5_rate", "trolley_6_rate"))
dat_long=na.omit(melt(data=dat, variable.name = "condition", value.name="rate"))
dat_long$personal_force = factor(ifelse(dat_long$condition=="trolley_3_rate"|dat_long$condition=="trolley_5_rate", 0, 1))
dat_long$intention = factor(ifelse(dat_long$condition=="trolley_4_rate"|dat_long$condition=="trolley_5_rate", 1, 0))
datt=lmBF(rate ~ personal_force*intention, data=dat_long, rscaleFixed=0.26)
datt2=lmBF(rate ~ personal_force+intention, data=dat_long, rscaleFixed=0.26)
datt3=as_tibble(datt/datt2)
tabledata_s2a_ne[i, "BF"]=signif(round(datt3[1,1],1),2)
frequentist=summary(aov(rate ~ personal_force*intention, data=dat_long))[[1]]
tabledata_s2a_ne[i, "F"]=round(frequentist[3, "F value"],3)
tabledata_s2a_ne[i, "df"]=paste("1, ", frequentist[4, "Df"])
tabledata_s2a_ne[i, "p"]=round(frequentist[3, "Pr(>F)"],3)
}
studys2a_results = rbind(tabledata_s2a, tabledata_s2a_ne)
rownames(studys2a_results) <- NULL
studys2a_results[studys2a_results==0.000]<-"<.001"
studys2a_results[,"RR"]<-c("2.2e-01, Inf", "1.3e-0.2, 2.3", "<1.0e-04, 3.1e+10", "2.7e-0.4, 1.1e+03", "<1.0e-04, 8.9e+15", "<1.0e-04, >1.0e+18")


kbl(
  studys2a_results,
  format = "latex",
  booktabs = T,
  escape=T,
  caption = "Do personal force interact with intention on Trolley dilemmas?",
  centering=T,
  position="H"
  )%>%
  kable_styling( full_width = F,  position="left")%>%
  row_spec(row=0, bold=TRUE)%>%
  collapse_rows(columns = 1, valign = "top", latex_hline = "major", row_group_label_position = "identity")

```


<!-- //graph with exclusion -->
```{r Study2a excl graph,fig.pos="H",out.width="90%",fig.cap="Results on Trolley dilemmas in Study 2 when all exclusions criteria are applied. Error bars are 95\\% confidence intervals on the mean. We can observe a significant interaction between personal force and intention on all cultural clusters.", echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE }

full=subset(study2a, select=c("trolley_3_rate", "trolley_4_rate", "trolley_5_rate", "trolley_6_rate", "survey_name"))
full$survey_name=factor(full$survey_name)
full2=melt(data=full, variable.name = "condition", value.name="rate", id="survey_name")
full2$personal_force=plyr::mapvalues(full2$condition, from=c("trolley_3_rate", "trolley_4_rate", "trolley_5_rate", "trolley_6_rate"), to=c("No Personal Force", "Personal force", "No Personal Force", "Personal force"))
full2$intention=plyr::mapvalues(full2$condition, from=c("trolley_3_rate", "trolley_4_rate", "trolley_5_rate", "trolley_6_rate"), to=c("No Intention", "Intention", "Intention", "No Intention"))

full2$survey_name=plyr::mapvalues(full2$survey_name, from=c("PSA006_Eastern", "PSA006_Western", "PSA006_Southern"), to=c("Eastern", "Western", "Southern"))
full2=na.omit(full2)



ggplot(full2, aes(x=intention, y=rate, fill=personal_force, width=0.7)) +
  stat_summary(fun=mean, geom="bar", position="dodge", colour="Black",  width=1.2)+
  stat_summary(fun.data=mean_cl_boot, geom="errorbar", position=position_dodge(width=0.7), colour="Black", width=0.2)+
  facet_wrap(facets=vars(survey_name)) +
  labs( y="To what extent is this action morally acceptable?")+ theme_bw()+
  expand_limits(y=c(1,9))+scale_y_continuous(breaks=c(1,2,3,4,5,6,7,8,9))+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.x=element_blank(), axis.title.y=element_text(face="bold", size=10), axis.text.x = element_text(face="bold", size=7, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_blank(),legend.text=element_text(size=9))

```


<!-- //graph without exclusion -->
```{r Study2a w/o excl graph, fig.pos="H",out.width="90%",fig.cap="Results on Trolley dilemmas in Study 2 when no exclusion criteria are applied. Error bars are 95\\% confidence intervals on the mean. We can observe a significant interaction between personal force and intention on all cultural clusters.",  echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE }

full=subset(trolley_proc, select=c("trolley_3_rate", "trolley_4_rate", "trolley_5_rate", "trolley_6_rate", "survey_name"))
full$survey_name=factor(full$survey_name)
full2=melt(data=full, variable.name = "condition", value.name="rate", id="survey_name")
full2$personal_force=plyr::mapvalues(full2$condition, from=c("trolley_3_rate", "trolley_4_rate", "trolley_5_rate", "trolley_6_rate"), to=c("No Personal Force", "Personal force", "No Personal Force", "Personal force"))
full2$intention=plyr::mapvalues(full2$condition, from=c("trolley_3_rate", "trolley_4_rate", "trolley_5_rate", "trolley_6_rate"), to=c("No Intention", "Intention", "Intention", "No Intention"))

full2$survey_name=plyr::mapvalues(full2$survey_name, from=c("PSA006_Eastern", "PSA006_Western", "PSA006_Southern"), to=c("Eastern", "Western", "Southern"))
full2=na.omit(full2)



ggplot(full2, aes(x=intention, y=rate, fill=personal_force, width=0.7)) +
  stat_summary(fun=mean, geom="bar", position="dodge", colour="Black",  width=1.2)+
  stat_summary(fun.data=mean_cl_boot, geom="errorbar", position=position_dodge(width=0.7), colour="Black", width=0.2)+
  facet_wrap(facets=vars(survey_name)) +
  labs( y="To what extent is this action morally acceptable?")+ theme_bw()+
  expand_limits(y=c(1,9))+scale_y_continuous(breaks=c(1,2,3,4,5,6,7,8,9))+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.x=element_blank(), axis.title.y=element_text(face="bold", size=10), axis.text.x = element_text(face="bold", size=7, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_blank(),legend.text=element_text(size=9))

```


##Study 2b

```{r study2b Bayesian, echo=FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}
tabledata_s2b = data.frame(Exclusion=c(rep("Exclusion",3)),Cluster=c("Eastern", "Southern", "Western"), matrix(nrow=3, ncol=5, dimnames=list(survey,c("BF","RR", "F", "df", "p"))))

for (i in survey){
dat=subset(study2b, survey_name==i, select=c("speedboat_3_rate", "speedboat_4_rate", "speedboat_5_rate", "speedboat_6_rate"))
dat_long=na.omit(melt(data=dat, variable.name = "condition", value.name="rate"))
dat_long$personal_force = factor(ifelse(dat_long$condition=="speedboat_3_rate"|dat_long$condition=="speedboat_5_rate", 0, 1))
dat_long$intention = factor(ifelse(dat_long$condition=="speedboat_4_rate"|dat_long$condition=="speedboat_5_rate", 1, 0))
datt=lmBF(rate ~ personal_force*intention, data=dat_long, rscaleFixed=0.26)
datt2=lmBF(rate ~ personal_force+intention, data=dat_long, rscaleFixed=0.26)
datt3=as_tibble(datt/datt2)
tabledata_s2b[i, "BF"]=signif(round(datt3[1,1],1),2)
frequentist=summary(aov(rate ~ personal_force*intention, data=dat_long))[[1]]
tabledata_s2b[i, "F"]=round(frequentist[3, "F value"],3)
tabledata_s2b[i, "df"]=paste("1, ", frequentist[4, "Df"])
tabledata_s2b[i, "p"]=round(frequentist[3, "Pr(>F)"],3)
}

tabledata_s2b_ne = data.frame(Exclusion=c(rep("No exclusion",3)),Cluster=c("Eastern", "Southern", "Western"), matrix(nrow=3, ncol=5, dimnames=list(survey,c("BF","RR", "F", "df", "p"))))
for (i in survey){
dat=subset(trolley_proc, survey_name==i, select=c("speedboat_3_rate", "speedboat_4_rate", "speedboat_5_rate", "speedboat_6_rate"))
dat_long=na.omit(melt(data=dat, variable.name = "condition", value.name="rate"))
dat_long$personal_force = factor(ifelse(dat_long$condition=="speedboat_3_rate"|dat_long$condition=="speedboat_5_rate", 0, 1))
dat_long$intention = factor(ifelse(dat_long$condition=="speedboat_4_rate"|dat_long$condition=="speedboat_5_rate", 1, 0))
datt=lmBF(rate ~ personal_force*intention, data=dat_long, rscaleFixed=0.26)
datt2=lmBF(rate ~ personal_force+intention, data=dat_long, rscaleFixed=0.26)
datt3=as_tibble(datt/datt2)
tabledata_s2b_ne[i, "BF"]=signif(round(datt3[1,1],1),2)
frequentist=summary(aov(rate ~ personal_force*intention, data=dat_long))[[1]]
tabledata_s2b_ne[i, "F"]=round(frequentist[3, "F value"],3)
tabledata_s2b_ne[i, "df"]=paste("1, ", frequentist[4, "Df"])
tabledata_s2b_ne[i, "p"]=round(frequentist[3, "Pr(>F)"],3)
}
studys2b_results = rbind(tabledata_s2b, tabledata_s2b_ne)
rownames(studys2b_results) <- NULL
studys2b_results[studys2b_results==0.000]<-"<.001"
studys2b_results[,"RR"]<-c("0, 2.8e-0.1", "2.2e-01, Inf", "1.2e-03, 1.5e+01, 3.1e+10", "8.0e-02, Inf", "0, 3.5e-01", "2.0e-0.3, 7.8e-01")


kbl(
  studys2b_results,
  format = "latex",
  booktabs = T,
  escape=T,
  caption = "Do personal force interact with intention on Speedboat dilemmas?",
  centering=T,
  position="H"
  )%>%
  kable_styling( full_width = F,  position="left")%>%
  row_spec(row=0, bold=TRUE)%>%
  collapse_rows(columns = 1, valign = "top", latex_hline = "major", row_group_label_position = "identity")



```


<!-- //graph with exclusion -->
```{r study2b excl graph, fig.pos="H",out.width="90%",fig.cap="Results on the Speedboat dilemmas in Study 2 when all exclusion criteria are applied. Error bars are 95\\% confidence intervals on the mean. We can observe a significant interaction between personal force and intention only on the Western cluster.",  echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE }

full=subset(study2b, select=c("speedboat_3_rate", "speedboat_4_rate", "speedboat_5_rate", "speedboat_6_rate", "survey_name"))
full$survey_name=factor(full$survey_name)
full2=melt(data=full, variable.name = "condition", value.name="rate", id="survey_name")
full2$personal_force=plyr::mapvalues(full2$condition, from=c("speedboat_3_rate", "speedboat_4_rate", "speedboat_5_rate", "speedboat_6_rate"), to=c("No Personal Force", "Personal force", "No Personal Force", "Personal force"))
full2$intention=plyr::mapvalues(full2$condition, from=c("speedboat_3_rate", "speedboat_4_rate", "speedboat_5_rate", "speedboat_6_rate"), to=c("No Intention", "Intention", "Intention", "No Intention"))

full2$survey_name=plyr::mapvalues(full2$survey_name, from=c("PSA006_Eastern", "PSA006_Western", "PSA006_Southern"), to=c("Eastern", "Western", "Southern"))
full2=na.omit(full2)



ggplot(full2, aes(x=intention, y=rate, fill=personal_force, width=0.7)) +
  stat_summary(fun=mean, geom="bar", position="dodge", colour="Black",  width=1.2)+
  stat_summary(fun.data=mean_cl_boot, geom="errorbar", position=position_dodge(width=0.7), colour="Black", width=0.2)+
  facet_wrap(facets=vars(survey_name)) +
  labs( y="To what extent is this action morally acceptable?")+ theme_bw()+
  expand_limits(y=c(1,9))+scale_y_continuous(breaks=c(1,2,3,4,5,6,7,8,9))+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.x=element_blank(), axis.title.y=element_text(face="bold", size=10), axis.text.x = element_text(face="bold", size=7, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_blank(),legend.text=element_text(size=9))

```


<!-- //graph without exclusion -->
```{r study2b w/o excl graph,fig.pos="H",out.width="90%",fig.cap="Results on the Speedboat dilemmas in Study 2 when no exclusion criteria is applied. Error bars are 95\\% confidence intervals on the mean. We can observe a significant interaction between personal force and intention only on the Western cluster.", echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE }

full=subset(trolley_proc, select=c("speedboat_3_rate", "speedboat_4_rate", "speedboat_5_rate", "speedboat_6_rate", "survey_name"))
full$survey_name=factor(full$survey_name)
full2=melt(data=full, variable.name = "condition", value.name="rate", id="survey_name")
full2$personal_force=plyr::mapvalues(full2$condition, from=c("speedboat_3_rate", "speedboat_4_rate", "speedboat_5_rate", "speedboat_6_rate"), to=c("No Personal Force", "Personal force", "No Personal Force", "Personal force"))
full2$intention=plyr::mapvalues(full2$condition, from=c("speedboat_3_rate", "speedboat_4_rate", "speedboat_5_rate", "speedboat_6_rate"), to=c("No Intention", "Intention", "Intention", "No Intention"))

full2$survey_name=plyr::mapvalues(full2$survey_name, from=c("PSA006_Eastern", "PSA006_Western", "PSA006_Southern"), to=c("Eastern", "Western", "Southern"))
full2=na.omit(full2)



ggplot(full2, aes(x=intention, y=rate, fill=personal_force, width=0.7)) +
  stat_summary(fun=mean, geom="bar", position="dodge", colour="Black",  width=1.2)+
  stat_summary(fun.data=mean_cl_boot, geom="errorbar", position=position_dodge(width=0.7), colour="Black", width=0.2)+
  facet_wrap(facets=vars(survey_name)) +
  labs( y="To what extent is this action morally acceptable?")+ theme_bw()+
  expand_limits(y=c(1,9))+scale_y_continuous(breaks=c(1,2,3,4,5,6,7,8,9))+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.x=element_blank(), axis.title.y=element_text(face="bold", size=10), axis.text.x = element_text(face="bold", size=7, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_blank(),legend.text=element_text(size=9))

```


#3. Effects of individualism-collectivism

##Study 1a
```{r analysis individual + country level study 1a, echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}
#for loop changes predictor variables
#table has 5lines: country level individualism, then individual level measures

vars=c("Collectivism", "ver_ind", "hor_ind", "ver_col", "hor_col")
tabledata_s1a_ind = data.frame(variable=c("Country-level collectivism", "Vertical Individualism", "Horizontal Individualism", "Vertical Collectivism", "Horizontal Collectivism"), matrix(nrow=5, ncol=3, dimnames=list(vars,c("BF", "b",  "p"))))


trolley_proc$country3=factor(trolley_proc$country3)
dat=subset(trolley_proc,  select=c("trolley_1_rate", "trolley_2_rate", "country3", vars))
dat_long=na.omit(melt(data=dat, variable.name = "condition", value.name="rate", id.vars=c(vars, "country3")))
dat_long$personal_force = factor(ifelse(dat_long$condition=="trolley_1_rate", 1, 0))

for (i in vars){
  if(i=="Collectivism"){
  datt=lmBF(rate ~  country3 + personal_force*Collectivism, data=dat_long, whichRandom=dat_long$country3,  rscaleFixed=0.26)
  datt2=lmBF(rate ~  country3 + personal_force+Collectivism, data=dat_long, whichRandom=dat_long$country3,  rscaleFixed=0.26)
  frequentist=broom.mixed::tidy(lmer(rate ~ personal_force*Collectivism +(1|country3), data=dat_long))
  } else if(i=="ver_ind"){
  datt=lmBF(rate ~  country3 + personal_force*ver_ind, data=dat_long, whichRandom=dat_long$country3,  rscaleFixed=0.26)
  datt2=lmBF(rate ~  country3 + personal_force+ver_ind, data=dat_long, whichRandom=dat_long$country3,  rscaleFixed=0.26)
  frequentist=broom.mixed::tidy(lmer(rate ~ personal_force*ver_ind +(1|country3), data=dat_long))
  }else if(i=="hor_ind"){
  datt=lmBF(rate ~  country3 + personal_force*hor_ind, data=dat_long, whichRandom=dat_long$country3, rscaleFixed=0.26)
  datt2=lmBF(rate ~  country3 + personal_force+hor_ind, data=dat_long, whichRandom=dat_long$country3, rscaleFixed=0.26)
  frequentist=broom.mixed::tidy(lmer(rate ~ personal_force*hor_ind +(1|country3), data=dat_long))
  }else if(i=="ver_col"){
  datt=lmBF(rate ~  country3 + personal_force*ver_col, data=dat_long, whichRandom=dat_long$country3,  rscaleFixed=0.26)
  datt2=lmBF(rate ~  country3 + personal_force+ver_col, data=dat_long, whichRandom=dat_long$country3,  rscaleFixed=0.26)
  frequentist=broom.mixed::tidy(lmer(rate ~ personal_force*ver_col +(1|country3), data=dat_long))
  }else if(i=="hor_col"){
  datt=lmBF(rate ~  country3 + personal_force*hor_col, data=dat_long, whichRandom=dat_long$country3,  rscaleFixed=0.26)
  datt2=lmBF(rate ~  country3 + personal_force+hor_col, data=dat_long, whichRandom=dat_long$country3,  rscaleFixed=0.26)
  frequentist=broom.mixed::tidy(lmer(rate ~ personal_force*hor_col +(1|country3), data=dat_long))
  }
datt3=as_tibble(datt/datt2)
tabledata_s1a_ind[i, "BF"]=signif(round(datt3[1,1],1),2)
tabledata_s1a_ind[i, "b"]=round(frequentist[4, "estimate"],3)
tabledata_s1a_ind[i, "p"]=round(frequentist[4, "p.value"],3)
}

rownames(tabledata_s1a_ind) <- NULL

kbl(
  tabledata_s1a_ind,
  format = "latex",
  booktabs = T,
  escape=T,
  caption = "Is the effect of personal force affected by individualism/collectivism on Trolley dilemmas?",
  centering=T,
  position="H"
  )%>%
  kable_styling( full_width = F,  position="left")%>%
  row_spec(row=0, bold=TRUE)%>%

```

<!-- Bayesian country level individualism w/o exclusion  -->
```{r study1a overall individualism plot, fig.pos="H",out.width="90%",fig.cap="Correlation between country-level individualism/collectivism and the effect of personal force in Cohen D on the Trolley dilemmas", echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}
##cohen d calculation for every country
#scatterplot: x effect size, y individualism
#size of dots: cohen d
countrydata=data.frame(country=levels(factor(trolley_proc$country3)), matrix(nrow=length(levels(factor(trolley_proc$country3))),ncol=3, dimnames=list(levels(factor(trolley_proc$country3)), c("cohend","Collectivism","N") )))

for (i in levels(factor(trolley_proc$country3))){
  d=subset(trolley_proc, country3==i, select=c("trolley_1_rate", "trolley_2_rate"))
  dat_long=na.omit(melt(data=d, variable.name = "condition", value.name="rate"))
  countrydata[i,"cohend"]=effsize::cohen.d(rate~condition, data=dat_long)$estimate
  countrydata[i,"Collectivism"]=mean(trolley_proc[trolley_proc$country3==i,]$Collectivism, na.rm=T)
  countrydata[i,"N"]=length(dat_long$rate)
}
countrydata=na.omit(countrydata)
ggplot(countrydata, aes(x=cohend, y=Collectivism, label=country)) +
  geom_point(aes(size=N))+
  geom_text(hjust=-0.2,size=3)+
  geom_smooth(method=lm, se=F)+ 
  xlab("Effect size")+
  theme_bw()+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.x=element_text(face="bold", size=12, colour="Black"), axis.title.y=element_text(face="bold", size=12, colour="Black"), axis.text.x = element_text(face="bold", size=10, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_text(face="bold", size=10, colour="Black"),legend.text=element_text(size=9))
  
  

```

<!-- Bayesian personal level individualism  w/o exclusion -->
```{r study1a vertical horizontal individualism, fig.show="hold", out.width="50%", fig.cap="Personal level individualism/collectivism effects on the Trolley dilemmas", echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}

#line plot, two conditions are different lines and y = acceptance, x individualism, should do it with allcol/ind scales.
ind=subset(trolley_proc, select=c("trolley_1_rate", "trolley_2_rate", "ver_ind", "ver_col", "hor_ind", "hor_col"))
ind2=melt(data=ind, variable.name = "condition", value.name="rate", id.vars=c("ver_ind", "ver_col", "hor_ind", "hor_col"))
ind2$condition=plyr::mapvalues(ind2$condition, from=c("trolley_1_rate", "trolley_2_rate"), to=c("Personal Force", "No personal force"))
ind2=na.omit(ind2)

  ggplot(ind2, aes(x=hor_ind, y=rate, color=condition)) +
  geom_smooth(method=lm)+
  labs( x= "Horizontal individualism", y="To what extent is this action morally acceptable?")+ theme_bw()+
  expand_limits(y=c(1,9))+
  scale_color_manual(values = c("#0000FF", "#FF0000"))+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.y=element_text(face="bold", size=12), axis.text.x = element_text(face="bold", size=9, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_blank(),legend.text=element_text(size=9),legend.position = c(.95, .95),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6)
)
  
  ggplot(ind2, aes(x=ver_ind, y=rate, color=condition)) +
  geom_smooth(method=lm)+
  labs( x= "Vertical individualism", y="")+ theme_bw()+
  expand_limits(y=c(1,9))+
  scale_color_manual(values = c("#0000FF", "#FF0000"))+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.y=element_text(face="bold", size=12), axis.text.x = element_text(face="bold", size=9, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_blank(),legend.position="none")
  
  ggplot(ind2, aes(x=hor_col, y=rate, color=condition)) +
  geom_smooth(method=lm)+
  labs( x= "Horizontal collectivism", y="To what extent is this action morally acceptable?")+ theme_bw()+
  expand_limits(y=c(1,9))+
  scale_color_manual(values = c("#0000FF", "#FF0000"))+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.y=element_text(face="bold", size=12), axis.text.x = element_text(face="bold", size=9, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),legend.title=element_blank(),legend.position="none")
    
  ggplot(ind2, aes(x=ver_col, y=rate, color=condition)) +
  geom_smooth(method=lm)+
  labs( x= "Vertical collectivism", y="")+ theme_bw()+
  expand_limits(y=c(1,9))+
  scale_color_manual(values = c("#0000FF", "#FF0000"))+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.y=element_text(face="bold", size=12), axis.text.x = element_text(face="bold", size=9, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_blank(),legend.position="none")


```

##Study 1b
```{r analysis individual + country level study 1b, echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}
#for loop changes predictor variables
#table has 5lines: country level individualism, then individual level measures

vars=c("Collectivism", "ver_ind", "hor_ind", "ver_col", "hor_col")
tabledata_s1b_ind = data.frame(variable=c("Country-level collectivism", "Vertical Individualism", "Horizontal Individualism", "Vertical Collectivism", "Horizontal Collectivism"), matrix(nrow=5, ncol=3, dimnames=list(vars,c("BF", "b",  "p"))))


dat=subset(trolley_proc,  select=c("speedboat_1_rate", "speedboat_2_rate", "country3", vars))
dat_long=na.omit(melt(data=dat, variable.name = "condition", value.name="rate", id.vars=c(vars, "country3")))
dat_long$personal_force = factor(ifelse(dat_long$condition=="speedboat_1_rate", 1, 0))

for (i in vars){
  if(i=="Collectivism"){
  datt=lmBF(rate ~  country3 + personal_force*Collectivism, data=dat_long, whichRandom=dat_long$country3,  rscaleFixed=0.26)
  datt2=lmBF(rate ~  country3 + personal_force+Collectivism, data=dat_long, whichRandom=dat_long$country3,  rscaleFixed=0.26)
  frequentist=broom.mixed::tidy(lmer(rate ~ personal_force*Collectivism +(1|country3), data=dat_long))
  } else if(i=="ver_ind"){
  datt=lmBF(rate ~  country3 + personal_force*ver_ind, data=dat_long, whichRandom=dat_long$country3,  rscaleFixed=0.26)
  datt2=lmBF(rate ~  country3 + personal_force+ver_ind, data=dat_long, whichRandom=dat_long$country3,  rscaleFixed=0.26)
  frequentist=broom.mixed::tidy(lmer(rate ~ personal_force*ver_ind +(1|country3), data=dat_long))
  }else if(i=="hor_ind"){
  datt=lmBF(rate ~  country3 + personal_force*hor_ind, data=dat_long, whichRandom=dat_long$country3, rscaleFixed=0.26)
  datt2=lmBF(rate ~  country3 + personal_force+hor_ind, data=dat_long, whichRandom=dat_long$country3, rscaleFixed=0.26)
  frequentist=broom.mixed::tidy(lmer(rate ~ personal_force*hor_ind +(1|country3), data=dat_long))
  }else if(i=="ver_col"){
  datt=lmBF(rate ~  country3 + personal_force*ver_col, data=dat_long, whichRandom=dat_long$country3,  rscaleFixed=0.26)
  datt2=lmBF(rate ~  country3 + personal_force+ver_col, data=dat_long, whichRandom=dat_long$country3,  rscaleFixed=0.26)
  frequentist=broom.mixed::tidy(lmer(rate ~ personal_force*ver_col +(1|country3), data=dat_long))
  }else if(i=="hor_col"){
  datt=lmBF(rate ~  country3 + personal_force*hor_col, data=dat_long, whichRandom=dat_long$country3,  rscaleFixed=0.26)
  datt2=lmBF(rate ~  country3 + personal_force+hor_col, data=dat_long, whichRandom=dat_long$country3,  rscaleFixed=0.26)
  frequentist=broom.mixed::tidy(lmer(rate ~ personal_force*hor_col +(1|country3), data=dat_long))
  }
datt3=as_tibble(datt/datt2)
tabledata_s1b_ind[i, "BF"]=signif(round(datt3[1,1],1),2)
tabledata_s1b_ind[i, "b"]=round(frequentist[4, "estimate"],3)
tabledata_s1b_ind[i, "p"]=round(frequentist[4, "p.value"],3)
}

rownames(tabledata_s1b_ind) <- NULL

kbl(
  tabledata_s1b_ind,
  format = "latex",
  booktabs = T,
  escape=T,
  caption = "Is the effect of personal force affected by individualism/collectivism on Speedboat dilemmas?",
  centering=T,
  position="H"
  )%>%
  kable_styling( full_width = F,  position="left")%>%
  row_spec(row=0, bold=TRUE)
```

<!-- Bayesian country level individualism w/o exclusion> -->
```{r study1b overall individualism plot, fig.pos="H",out.width="90%",fig.cap="Correlation between country-level individualism/collectivism and the effect of personal force in Cohen D on the Speedboat dilemmas", echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}
##cohen d calculation for every country
#scatterplot: x effect size, y individualism
#size of dots: cohen d
countrydata=data.frame(country=levels(factor(trolley_proc$country3)), matrix(nrow=length(levels(factor(trolley_proc$country3))),ncol=3, dimnames=list(levels(factor(trolley_proc$country3)), c("cohend","Collectivism","N") )))

for (i in levels(factor(trolley_proc$country3))){
  d=subset(trolley_proc, country3==i, select=c("speedboat_1_rate", "speedboat_2_rate"))
  dat_long=na.omit(melt(data=d, variable.name = "condition", value.name="rate"))
  countrydata[i,"cohend"]=effsize::cohen.d(rate~condition, data=dat_long)$estimate
  countrydata[i,"Collectivism"]=mean(trolley_proc[trolley_proc$country3==i,]$Collectivism, na.rm=T)
  countrydata[i,"N"]=length(dat_long$rate)
}
countrydata=na.omit(countrydata)
ggplot(countrydata, aes(x=cohend, y=Collectivism, label=country)) +
  geom_point(aes(size=N))+
  geom_text(hjust=-0.2,size=3)+
  geom_smooth(method=lm, se=F)+ 
  xlab("Effect size")+
  theme_bw()+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.x=element_text(face="bold", size=12, colour="Black"), axis.title.y=element_text(face="bold", size=12, colour="Black"), axis.text.x = element_text(face="bold", size=10, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_text(face="bold", size=10, colour="Black"),legend.text=element_text(size=9))
  
  

```


<!-- Bayesian personal level individualism  w/o exclusion-->
```{r study1b vertical horizontal individualism, fig.show="hold", out.width="50%", fig.cap="Personal level individualism/collectivism effects on the Speedboat dilemmas", echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}

#line plot, two conditions are different lines and y = acceptance, x individualism, should do it with allcol/ind scales.
ind=subset(trolley_proc, select=c("speedboat_1_rate", "speedboat_2_rate", "ver_ind", "ver_col", "hor_ind", "hor_col"))
ind2=melt(data=ind, variable.name = "condition", value.name="rate", id.vars=c("ver_ind", "ver_col", "hor_ind", "hor_col"))
ind2$condition=plyr::mapvalues(ind2$condition, from=c("speedboat_1_rate", "speedboat_2_rate"), to=c("Personal Force", "No personal force"))
ind2=na.omit(ind2)

  ggplot(ind2, aes(x=hor_ind, y=rate, color=condition)) +
  geom_smooth(method=lm)+
  labs( x= "Horizontal individualism", y="To what extent is this action morally acceptable?")+ theme_bw()+
  expand_limits(y=c(1,9))+
  scale_color_manual(values = c("#0000FF", "#FF0000"))+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.y=element_text(face="bold", size=12), axis.text.x = element_text(face="bold", size=9, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_blank(),legend.text=element_text(size=9),legend.position = c(.95, .95),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6)
)
  
  ggplot(ind2, aes(x=ver_ind, y=rate, color=condition)) +
  geom_smooth(method=lm)+
  labs( x= "Vertical individualism", y="")+ theme_bw()+
  expand_limits(y=c(1,9))+
  scale_color_manual(values = c("#0000FF", "#FF0000"))+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.y=element_text(face="bold", size=12), axis.text.x = element_text(face="bold", size=9, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_blank(),legend.position="none")
  
  ggplot(ind2, aes(x=hor_col, y=rate, color=condition)) +
  geom_smooth(method=lm)+
  labs( x= "Horizontal collectivism", y="To what extent is this action morally acceptable?")+ theme_bw()+
  expand_limits(y=c(1,9))+
  scale_color_manual(values = c("#0000FF", "#FF0000"))+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.y=element_text(face="bold", size=12), axis.text.x = element_text(face="bold", size=9, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),legend.title=element_blank(),legend.position="none")
    
  ggplot(ind2, aes(x=ver_col, y=rate, color=condition)) +
  geom_smooth(method=lm)+
  labs( x= "Vertical collectivism", y="")+ theme_bw()+
  expand_limits(y=c(1,9))+
  scale_color_manual(values = c("#0000FF", "#FF0000"))+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.y=element_text(face="bold", size=12), axis.text.x = element_text(face="bold", size=9, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_blank(),legend.position="none")


```


##Study 2a


<!-- Bayesian country level individualism w/o exclusion -->
```{r analysis individual + country level study 2a, echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}
#for loop changes predictor variables
#table has 5lines: country level individualism, then individual level measures

vars=c("Collectivism", "ver_ind", "hor_ind", "ver_col", "hor_col")
tabledata_s2a_ind = data.frame(variable=c("Country-level collectivism", "Vertical Individualism", "Horizontal Individualism", "Vertical Collectivism", "Horizontal Collectivism"), matrix(nrow=5, ncol=3, dimnames=list(vars,c("BF", "b",  "p"))))


dat=subset(trolley_proc,  select=c("trolley_3_rate", "trolley_4_rate", "trolley_5_rate", "trolley_6_rate", "country3", vars))
dat_long=na.omit(melt(data=dat, variable.name = "condition", value.name="rate", id.vars=c(vars, "country3")))
dat_long$personal_force = factor(ifelse(dat_long$condition=="trolley_3_rate"|dat_long$condition=="trolley_5_rate", 0, 1))
dat_long$intention = factor(ifelse(dat_long$condition=="trolley_4_rate"|dat_long$condition=="trolley_5_rate", 1, 0))

for (i in vars){
  if(i=="Collectivism"){
  datt=lmBF(rate ~  country3 + personal_force*intention*Collectivism, data=dat_long, whichRandom=dat_long$country3,  rscaleFixed=0.26)
  datt2=lmBF(rate ~ country3 + personal_force+intention+Collectivism+personal_force:Collectivism+personal_force:intention+intention:Collectivism, whichRandom=dat_long$country3,data=dat_long, rscaleFixed=0.26)  
  frequentist=broom.mixed::tidy(lmer(rate ~ personal_force*intention*Collectivism +(1|country3), data=dat_long))
  } else if(i=="ver_ind"){
  datt=lmBF(rate ~  country3 + personal_force*intention*ver_ind, data=dat_long, whichRandom=dat_long$country3,  rscaleFixed=0.26)
  datt2=lmBF(rate ~ country3+personal_force+intention+ver_ind+personal_force:ver_ind+personal_force:intention+intention:ver_ind, whichRandom=dat_long$country3,      data=dat_long, rscaleFixed=0.26)  
  frequentist=broom.mixed::tidy(lmer(rate ~ personal_force*intention*ver_ind +(1|country3), data=dat_long))
  }else if(i=="hor_ind"){
  datt=lmBF(rate ~  country3 + personal_force*intention*hor_ind, data=dat_long, whichRandom=dat_long$country3, rscaleFixed=0.26)
  datt2=lmBF(rate ~ country3 + personal_force+intention+hor_ind+personal_force:hor_ind+personal_force:intention+intention:hor_ind, whichRandom=dat_long$country3, data=dat_long,  rscaleFixed=0.26)  
  frequentist=broom.mixed::tidy(lmer(rate ~ personal_force*intention*hor_ind +(1|country3), data=dat_long))
  }else if(i=="ver_col"){
  datt=lmBF(rate ~  country3 + personal_force*intention*ver_col, data=dat_long, whichRandom=dat_long$country3,  rscaleFixed=0.26)
  datt2=lmBF(rate ~ country3 + personal_force+intention+ver_col+personal_force:ver_col+personal_force:intention+intention:ver_col, whichRandom=dat_long$country3,      data=dat_long, rscaleFixed=0.26)  
  frequentist=broom.mixed::tidy(lmer(rate ~ personal_force*intention*ver_col +(1|country3), data=dat_long))
  }else if(i=="hor_col"){
  datt=lmBF(rate ~  country3 + personal_force+intention+hor_col+personal_force:hor_col+personal_force:intention+intention:hor_col+personal_force:intention:hor_col, data=dat_long, whichRandom=dat_long$country3,  rscaleFixed=0.26)
  datt2=lmBF(rate ~ country3 + personal_force+intention+hor_col+personal_force:hor_col+personal_force:intention+intention:hor_col, whichRandom=dat_long$country3,   data=dat_long, rscaleFixed=0.26)  
  frequentist=broom.mixed::tidy(lmer(rate ~ personal_force*intention*hor_col +(1|country3), data=dat_long))
  }
datt3=as_tibble(datt/datt2)
tabledata_s2a_ind[i, "BF"]=signif(round(datt3[1,1],1),2)
tabledata_s2a_ind[i, "b"]=round(frequentist[8, "estimate"],3)
tabledata_s2a_ind[i, "p"]=round(frequentist[8, "p.value"],3)
}

rownames(tabledata_s2a_ind) <- NULL

kbl(
  tabledata_s2a_ind,
  format = "latex",
  booktabs = T,
  escape=T,
  caption = "Is the interaction of personal force and intention affected by individualism/collectivism on Trolley dilemmas?",
  centering=T,
  position="H"
  )%>%
  kable_styling( full_width = F,  position="left")%>%
  row_spec(row=0, bold=TRUE)

```


```{r study2a overall individualism plot, fig.pos="H",out.width="90%",fig.cap="Correlation between country-level individualism/collectivism and the effect of personal force in Cohen D on the Trolley dilemmas", echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}
##cohen d calculation for every country
#scatterplot: x effect size, y individualism
#size of dots: cohen d
countrydata=data.frame(country=levels(factor(trolley_proc$country3)), matrix(nrow=length(levels(factor(trolley_proc$country3))),ncol=3, dimnames=list(levels(factor(trolley_proc$country3)), c("cohend","Collectivism","N") )))

for (i in levels(factor(trolley_proc$country3))){
  d=subset(trolley_proc, country3==i, select=c("trolley_3_rate", "trolley_4_rate", "trolley_5_rate", "trolley_6_rate"))
  dat_long=na.omit(melt(data=d, variable.name = "condition", value.name="rate"))
  dat_long$personal_force = factor(ifelse(dat_long$condition=="trolley_3_rate"|dat_long$condition=="trolley_5_rate", 0, 1))
  dat_long$intention = factor(ifelse(dat_long$condition=="trolley_4_rate"|dat_long$condition=="trolley_5_rate", 1, 0))
  if (length(dat_long$rate)<10){
    countrydata[i,"cohend"]=NA
  }else{
    countrydata[i,"cohend"]=effectsize::eta_squared(aov(rate~intention:personal_force, data=dat_long))$Eta2
  }
  countrydata[i,"Collectivism"]=mean(trolley_proc[trolley_proc$country3==i,]$Collectivism, na.rm=T)
  countrydata[i,"N"]=length(dat_long$rate)
}

countrydata=na.omit(countrydata)
ggplot(countrydata, aes(x=cohend, y=Collectivism, label=country)) +
  geom_point(aes(size=N))+
  geom_text(hjust=-0.2,size=3)+
  geom_smooth(method=lm, se=F)+ 
  xlab("Effect size")+
  theme_bw()+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.x=element_text(face="bold", size=12, colour="Black"), axis.title.y=element_text(face="bold", size=12, colour="Black"), axis.text.x = element_text(face="bold", size=10, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_text(face="bold", size=10, colour="Black"),legend.text=element_text(size=9))
  
  

```


<!-- Bayesian personal level individualism  w/o exclusion-->
```{r study2a vertical horizontal individualism, fig.show="hold", out.width="50%", fig.cap="Personal level individualism/collectivism effects on the interaction of personal force and intention (trolley dilemmas)", echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}

#line plot, two conditions are different lines and y = acceptance, x individualism, should do it with allcol/ind scales.

ind=subset(trolley_proc, select=c("trolley_3_rate", "trolley_4_rate", "trolley_5_rate", "trolley_6_rate", "ver_ind", "ver_col", "hor_ind", "hor_col"))
ind2=melt(data=ind, variable.name = "condition", value.name="rate", id.vars=c("ver_ind", "ver_col", "hor_ind", "hor_col"))
ind2$personal_force = factor(ifelse(ind2$condition=="trolley_3_rate"|ind2$condition=="trolley_5_rate", 0, 1), labels=c("No personal force","Personal force"))
ind2$intention = factor(ifelse(ind2$condition=="trolley_4_rate"|ind2$condition=="trolley_5_rate", 1, 0), labels=c("No intention", "Intention"))

ind2=na.omit(ind2)

  ggplot(ind2, aes(x=hor_ind, y=rate, color=personal_force)) +
  geom_smooth(method=lm)+
  labs( x= "Horizontal individualism", y="To what extent is this action morally acceptable?")+ theme_bw()+
  expand_limits(y=c(1,9))+
  facet_wrap(facets=vars(intention))+
  scale_color_manual(values = c("#0000FF", "#FF0000"))+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.y=element_text(face="bold", size=12), axis.text.x = element_text(face="bold", size=9, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_blank(),legend.text=element_text(size=9),legend.position = c(.95, .95),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6)
)
  
  ggplot(ind2, aes(x=ver_ind, y=rate, color=personal_force)) +
  geom_smooth(method=lm)+
  labs( x= "Vertical individualism", y="")+ theme_bw()+
  expand_limits(y=c(1,9))+
  facet_wrap(facets=vars(intention))+
  scale_color_manual(values = c("#0000FF", "#FF0000"))+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.y=element_text(face="bold", size=12), axis.text.x = element_text(face="bold", size=9, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_blank(),legend.position="none")
  
  ggplot(ind2, aes(x=hor_col, y=rate, color=personal_force)) +
  geom_smooth(method=lm)+
  labs( x= "Horizontal collectivism", y="To what extent is this action morally acceptable?")+ theme_bw()+
  expand_limits(y=c(1,9))+
  facet_wrap(facets=vars(intention))+
  scale_color_manual(values = c("#0000FF", "#FF0000"))+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.y=element_text(face="bold", size=12), axis.text.x = element_text(face="bold", size=9, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),legend.title=element_blank(),legend.position="none")
    
  ggplot(ind2, aes(x=ver_col, y=rate, color=personal_force)) +
  geom_smooth(method=lm)+
  labs( x= "Vertical collectivism", y="")+ theme_bw()+
  expand_limits(y=c(1,9))+
  facet_wrap(facets=vars(intention))+
  scale_color_manual(values = c("#0000FF", "#FF0000"))+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.y=element_text(face="bold", size=12), axis.text.x = element_text(face="bold", size=9, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_blank(),legend.position="none")


```

##Study 2b

<!-- Bayesian country level individualism w/o exclusion -->
```{r analysis individual + country level study 2b, echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}
#for loop changes predictor variables
#table has 5lines: country level individualism, then individual level measures

vars=c("Collectivism", "ver_ind", "hor_ind", "ver_col", "hor_col")
tabledata_s2b_ind = data.frame(variable=c("Country-level collectivism", "Vertical Individualism", "Horizontal Individualism", "Vertical Collectivism", "Horizontal Collectivism"), matrix(nrow=5, ncol=3, dimnames=list(vars,c("BF", "b",  "p"))))


dat=subset(trolley_proc,  select=c("speedboat_3_rate", "speedboat_4_rate", "speedboat_5_rate", "speedboat_6_rate", "country3", vars))
dat_long=na.omit(melt(data=dat, variable.name = "condition", value.name="rate", id.vars=c(vars, "country3")))
dat_long$personal_force = factor(ifelse(dat_long$condition=="speedboat_3_rate"|dat_long$condition=="speedboat_5_rate", 0, 1))
dat_long$intention = factor(ifelse(dat_long$condition=="speedboat_4_rate"|dat_long$condition=="speedboat_5_rate", 1, 0))

for (i in vars){
  if(i=="Collectivism"){
  datt=lmBF(rate ~  country3 + personal_force*intention*Collectivism, data=dat_long, whichRandom=dat_long$country3,  rscaleFixed=0.26)
  datt2=lmBF(rate ~ country3 + personal_force+intention+Collectivism+personal_force:Collectivism+personal_force:intention+intention:Collectivism, whichRandom=dat_long$country3,data=dat_long, rscaleFixed=0.26)  
  frequentist=broom.mixed::tidy(lmer(rate ~ personal_force*intention*Collectivism +(1|country3), data=dat_long))
  } else if(i=="ver_ind"){
  datt=lmBF(rate ~  country3 + personal_force*intention*ver_ind, data=dat_long, whichRandom=dat_long$country3,  rscaleFixed=0.26)
  datt2=lmBF(rate ~ country3+personal_force+intention+ver_ind+personal_force:ver_ind+personal_force:intention+intention:ver_ind, whichRandom=dat_long$country3,      data=dat_long, rscaleFixed=0.26)  
  frequentist=broom.mixed::tidy(lmer(rate ~ personal_force*intention*ver_ind +(1|country3), data=dat_long))
  }else if(i=="hor_ind"){
  datt=lmBF(rate ~  country3 + personal_force*intention*hor_ind, data=dat_long, whichRandom=dat_long$country3, rscaleFixed=0.26)
  datt2=lmBF(rate ~ country3 + personal_force+intention+hor_ind+personal_force:hor_ind+personal_force:intention+intention:hor_ind, whichRandom=dat_long$country3, data=dat_long,  rscaleFixed=0.26)  
  frequentist=broom.mixed::tidy(lmer(rate ~ personal_force*intention*hor_ind +(1|country3), data=dat_long))
  }else if(i=="ver_col"){
  datt=lmBF(rate ~  country3 + personal_force*intention*ver_col, data=dat_long, whichRandom=dat_long$country3,  rscaleFixed=0.26)
  datt2=lmBF(rate ~ country3 + personal_force+intention+ver_col+personal_force:ver_col+personal_force:intention+intention:ver_col, whichRandom=dat_long$country3,      data=dat_long, rscaleFixed=0.26)  
  frequentist=broom.mixed::tidy(lmer(rate ~ personal_force*intention*ver_col +(1|country3), data=dat_long))
  }else if(i=="hor_col"){
  datt=lmBF(rate ~  country3 + personal_force+intention+hor_col+personal_force:hor_col+personal_force:intention+intention:hor_col+personal_force:intention:hor_col, data=dat_long, whichRandom=dat_long$country3,  rscaleFixed=0.26)
  datt2=lmBF(rate ~ country3 + personal_force+intention+hor_col+personal_force:hor_col+personal_force:intention+intention:hor_col, whichRandom=dat_long$country3,   data=dat_long, rscaleFixed=0.26)  
  frequentist=broom.mixed::tidy(lmer(rate ~ personal_force*intention*hor_col +(1|country3), data=dat_long))
  }
datt3=as_tibble(datt/datt2)
tabledata_s2b_ind[i, "BF"]=signif(round(datt3[1,1],1),2)
tabledata_s2b_ind[i, "b"]=round(frequentist[8, "estimate"],3)
tabledata_s2b_ind[i, "p"]=round(frequentist[8, "p.value"],3)
}

rownames(tabledata_s2b_ind) <- NULL

kbl(
  tabledata_s2b_ind,
  format = "latex",
  booktabs = T,
  escape=T,
  caption = "Is the interaction of personal force and intention affected by individualism/collectivism on Speedboat dilemmas?",
  centering=T,
  position="H"
  )%>%
  kable_styling( full_width = F,  position="left")%>%
  row_spec(row=0, bold=TRUE)



```


```{r study2b overall individualism plot, fig.pos="H",out.width="90%",fig.cap="Correlation between country-level individualism/collectivism and the interactional effect of personal force and intention in Eta squared on Speedboat dilemmas", echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}
##cohen d calculation for every country
#scatterplot: x effect size, y individualism
#size of dots: cohen d
countrydata=data.frame(country=levels(factor(trolley_proc$country3)), matrix(nrow=length(levels(factor(trolley_proc$country3))),ncol=3, dimnames=list(levels(factor(trolley_proc$country3)), c("cohend","Collectivism","N") )))

for (i in levels(factor(trolley_proc$country3))){
  d=subset(trolley_proc, country3==i, select=c("speedboat_3_rate", "speedboat_4_rate", "speedboat_5_rate", "speedboat_6_rate"))
  dat_long=na.omit(melt(data=d, variable.name = "condition", value.name="rate"))
  dat_long$personal_force = factor(ifelse(dat_long$condition=="speedboat_3_rate"|dat_long$condition=="speedboat_5_rate", 0, 1))
  dat_long$intention = factor(ifelse(dat_long$condition=="speedboat_4_rate"|dat_long$condition=="speedboat_5_rate", 1, 0))
  if (length(dat_long$rate)<10){
    countrydata[i,"cohend"]=NA
  }else{
    countrydata[i,"cohend"]=effectsize::eta_squared(aov(rate~intention:personal_force, data=dat_long))$Eta2
  }
  countrydata[i,"Collectivism"]=mean(trolley_proc[trolley_proc$country3==i,]$Collectivism, na.rm=T)
  countrydata[i,"N"]=length(dat_long$rate)
}

countrydata=na.omit(countrydata)
ggplot(countrydata, aes(x=cohend, y=Collectivism, label=country)) +
  geom_point(aes(size=N))+
  geom_text(hjust=-0.2,size=3)+
  geom_smooth(method=lm, se=F)+ 
  xlab("Effect size")+
  theme_bw()+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.x=element_text(face="bold", size=12, colour="Black"), axis.title.y=element_text(face="bold", size=12, colour="Black"), axis.text.x = element_text(face="bold", size=10, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_text(face="bold", size=10, colour="Black"),legend.text=element_text(size=9))
  
  

```


<!-- Bayesian personal level individualism  w/o exclusion-->
```{r study2b vertical horizontal individualism, fig.show="hold", out.width="50%", fig.cap="Personal level individualism/collectivism effects on the interaction of personal force and intention (speedboat dilemmas)", echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}

#line plot, two conditions are different lines and y = acceptance, x individualism, should do it with allcol/ind scales.

ind=subset(trolley_proc, select=c("speedboat_3_rate", "speedboat_4_rate", "speedboat_5_rate", "speedboat_6_rate", "ver_ind", "ver_col", "hor_ind", "hor_col"))
ind2=melt(data=ind, variable.name = "condition", value.name="rate", id.vars=c("ver_ind", "ver_col", "hor_ind", "hor_col"))
ind2$personal_force = factor(ifelse(ind2$condition=="speedboat_3_rate"|ind2$condition=="speedboat_5_rate", 0, 1), labels=c("No personal force","Personal force"))
ind2$intention = factor(ifelse(ind2$condition=="speedboat_4_rate"|ind2$condition=="speedboat_5_rate", 1, 0), labels=c("No intention", "Intention"))

ind2=na.omit(ind2)

  ggplot(ind2, aes(x=hor_ind, y=rate, color=personal_force)) +
  geom_smooth(method=lm)+
  labs( x= "Horizontal individualism", y="To what extent is this action morally acceptable?")+ theme_bw()+
  expand_limits(y=c(1,9))+
  facet_wrap(facets=vars(intention))+
  scale_color_manual(values = c("#0000FF", "#FF0000"))+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.y=element_text(face="bold", size=12), axis.text.x = element_text(face="bold", size=9, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_blank(),legend.text=element_text(size=9),legend.position = c(.95, .95),legend.justification = c("right", "top"),legend.box.just = "right",legend.margin = margin(6, 6, 6, 6)
)
  
  ggplot(ind2, aes(x=ver_ind, y=rate, color=personal_force)) +
  geom_smooth(method=lm)+
  labs( x= "Vertical individualism", y="")+ theme_bw()+
  expand_limits(y=c(1,9))+
  facet_wrap(facets=vars(intention))+
  scale_color_manual(values = c("#0000FF", "#FF0000"))+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.y=element_text(face="bold", size=12), axis.text.x = element_text(face="bold", size=9, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_blank(),legend.position="none")
  
  ggplot(ind2, aes(x=hor_col, y=rate, color=personal_force)) +
  geom_smooth(method=lm)+
  labs( x= "Horizontal collectivism", y="To what extent is this action morally acceptable?")+ theme_bw()+
  expand_limits(y=c(1,9))+
  facet_wrap(facets=vars(intention))+
  scale_color_manual(values = c("#0000FF", "#FF0000"))+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.y=element_text(face="bold", size=12), axis.text.x = element_text(face="bold", size=9, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),legend.title=element_blank(),legend.position="none")
    
  ggplot(ind2, aes(x=ver_col, y=rate, color=personal_force)) +
  geom_smooth(method=lm)+
  labs( x= "Vertical collectivism", y="")+ theme_bw()+
  expand_limits(y=c(1,9))+
  facet_wrap(facets=vars(intention))+
  scale_color_manual(values = c("#0000FF", "#FF0000"))+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.y=element_text(face="bold", size=12), axis.text.x = element_text(face="bold", size=9, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_blank(),legend.position="none")


```



#4. Additional analysis
##Effect of physical contact and intention

In every cluster and for both types of dilemma we found good enough evidence supporting the alternative hypothesis when testing the effect of physical contact and the effect of intention. The summary of the results can be found in Table X.

```{r}
# Load the processed data without any exclusion
trolley_proc <- vroom(here::here("data", "trolley_preprocessed.csv"))

# Tidy Bf extractor function
my_bf_extractor <- function(bf_obj) {
  BayesFactor::extractBF(bf_obj) %>% 
    tibble::rownames_to_column(var = "scale") %>% 
    dplyr::mutate(scale = stringr::str_extract(scale, "(?<=\\s)(.*)(?=\\s)"))
}

# Comparing standard footbridge with footbridge pole in every cluster
additional_res_1 <- 
  trolley_proc %>% 
  select(survey_name, survey_id, matches("trolley_[0-9]_rate|speedboat_[0-9]_rate")) %>% 
  pivot_longer(matches("_rate"), names_to = "task", names_pattern = "(.*)_rate", values_to = "rate") %>% 
  mutate(comparison = case_when(task %in% c("trolley_1", "trolley_4") ~ "trolley_physical",
                                task %in% c("speedboat_1", "speedboat_4") ~ "speedboat_physical",
                                task %in% c("trolley_3", "trolley_2") ~ "trolley_intention",
                                task %in% c("speedboat_3", "speedboat_2") ~ "speedboat_intention",
                                TRUE ~ NA_character_)) %>% 
  drop_na(rate, comparison) %>% 
  nest(data = c(survey_id, task, rate)) %>% 
  mutate(bf_res = map(data, ~ ttestBF(formula = rate ~ task, data = .x, rscale=0.26)),
         bf = map_dbl(bf_res, ~ round(my_bf_extractor(.x)$bf, 2)),
         freq_res = map(data, ~ t.test(rate ~ task, data = .x,  paired = FALSE) %>% broom::tidy()),
         t = map_dbl(freq_res, ~ round(.x$statistic, 2)),
         p = map_dbl(freq_res, ~ round(.x$p.value, 2)),
         df = map_dbl(freq_res, ~ round(.x$parameter, 2)))

additional_res_1 %>% 
  filter(str_detect(comparison, "intention|physical")) %>% 
  separate(comparison, into = c("Dilemma", "Comparison"), sep = "_") %>% 
  transmute(Cluster = str_remove(survey_name, "^[^_]*_"),
            Dilemma = str_to_title(Dilemma),
            Comparison = case_when(Comparison == "physical" ~ "Physical Contact",
                                   Comparison == "intention" ~ "Intention"),
            `t value` = t,
            `B` = bf,
            `Degrees of Freedom` = df,
            `p value` = p) %>% 
  papaja::apa_table(
    caption = "Effect of Physical Contact and Intention",
    escape = TRUE)
```

##Comparing the standard switch and standard footbridge dilemmas

When comparing the standard switch and standard footbridge dilemmas in all clusters for the trolley and the speedboat tasks we found good enough evidence in every case for the support of the alternative hypothesis. The summary results of each comparison separately can be found in Table X.

```{r}
additional_res_2 <- 
  trolley_proc %>% 
  select(survey_name, survey_id, matches("trolley_[0-9]_rate|speedboat_[0-9]_rate")) %>% 
  pivot_longer(matches("_rate"), names_to = "task", names_pattern = "(.*)_rate", values_to = "rate") %>% 
  mutate(comparison = case_when(task %in% c("trolley_3", "trolley_4") ~ "trolley_standard",
                                task %in% c("speedboat_3", "speedboat_4") ~ "speedboat_standard",
                                TRUE ~ NA_character_)) %>% 
  drop_na(rate, comparison) %>% 
  nest(data = c(survey_id, task, rate)) %>% 
  mutate(bf_res = map(data, ~ ttestBF(formula = rate ~ task, data = .x, rscale=0.26)),
         bf = map_dbl(bf_res, ~ round(my_bf_extractor(.x)$bf, 2)),
         freq_res = map(data, ~ t.test(rate ~ task, data = .x,  paired = FALSE) %>% broom::tidy()),
         t = map_dbl(freq_res, ~ round(.x$statistic, 2)),
         p = map_dbl(freq_res, ~ round(.x$p.value, 2)),
         df = map_dbl(freq_res, ~ round(.x$parameter, 2)))

additional_res_2 %>% 
  filter(str_detect(comparison, "standard")) %>% 
  separate(comparison, into = c("Dilemma", "Comparison"), sep = "_") %>% 
  transmute(Cluster = str_remove(survey_name, "^[^_]*_"),
            Dilemma = str_to_title(Dilemma),
            `t value` = t,
            `B` = bf,
            `Degrees of Freedom` = df,
            `p value` = p) %>% 
  papaja::apa_table(
    caption = "Comparing the Standard Switch and Standard Footbridge Dilemmas",
    escape = TRUE)
```

<!-- Oxford Utilitarianism Scale <MARCI> -->
