---
title: "Supplementary materials"
author: "Bence Bago"
date: "14 January 2021"
output:
  rmarkdown::pdf_document:
    extra_dependencies: ["float"]
    fig_caption: yes        
header-includes: 
  \usepackage{float} \floatplacement{figure}{H} 
  \newcommand{\beginsupplement}{\setcounter{table}{0}  \renewcommand{\thetable}{S\arabic{table}} \setcounter{figure}{0} \renewcommand{\thefigure}{S\arabic{figure}}}
editor_options: 
  chunk_output_type: console
---

\beginsupplement
```{r setup, echo=FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}
# Load packages
library(BayesFactor)
library(reshape2)
library(ggplot2)
library(kableExtra)
library(lmerTest)
library(tidyverse)
library(jsonlite)
library(lubridate)
library(vroom)
library(countrycode)
library(gt)
library(janitor)
library(here)
library(ggrepel)


trolley_raw <- read_csv("data/trolley_raw.csv")
trolley_proc <- read_csv("data/trolley_preprocessed.csv")
study1a <- read_csv("data/study1a.csv")
study1b <- read_csv("data/study1b.csv")
study2a <- read_csv("data/study2a.csv")
study2b <- read_csv("data/study2b.csv")

#raw=levels(factor(trolley_raw$lab))

#processed=levels(factor(trolley_proc$lab))

#k=setdiff(raw,processed)
#f=trolley_raw[trolley_raw$lab %in% k ,]
#table(f$lab)

```

```{r echo = FALSE}
# Show the labs who are in the raw dataset but not in the processed
# Most likely these labs sent out the survey with the practice link
missing_labs <- 
  trolley_raw %>% 
  distinct(lab) %>% 
  anti_join(., distinct(trolley_proc, lab), by = "lab") %>% 

# show the number of participants missing in each lab
trolley_raw %>% 
  inner_join(., missing_labs, by = "lab") %>% 
  count(lab) %>% 
  ungroup() %>% 
  mutate(all_n = sum(n))
```

```{r}
# Show the number of participants excluded because of not finished responses
trolley_raw %>%
  filter(str_detect(str_to_lower(practice), "false")) %>% 
  filter(!(lab == "TUR_021" & StartDate < date("2020-04-22")),
         !(lab == "AUT_003" & StartDate < date("2020-06-18")),
         !(lab == "USA_095")) %>% 
  filter(Progress < 98) %>% 
  count()
```

```{r individualism score, echo=FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}

cd_raw <- read_csv(here("data/collectivism_similarity_matrix-from_culturaldistance.com.csv"))

cd <- 
  cd_raw %>% 
  transmute(country = names(.),
            Collectivism = `United States2010-2014`) %>% 
  extract(country, 
          into = c("Country", "distance_year"), 
          regex = "(.*)(\\d{4}-\\d{4})") %>% 
  # Get the latest similarity data
  group_by(Country) %>% 
  slice_tail(n = 1) %>% 
  ungroup() %>% 
  # USA should have 0 distance (not NA)
  mutate(Collectivism = if_else(is.na(Collectivism), 0, Collectivism),
         country3 = countryname(sourcevar = Country, 
                                destination = "iso3c")) 

trolley_proc$lab=as.character(trolley_proc$lab)
trolley_proc$country3=sub("^([A-z]+)_([0-9]+)$", "\\1",  trolley_proc$lab)
trolley_proc$country3=recode(trolley_proc$country3,SWT="CHE", LEB = "LBN", BUL = "BGR", SPA = "ESP")
trolley_proc=merge(trolley_proc, cd, by=c("country3"))

###individualism/collectivism scale
attach(trolley_proc)
trolley_proc$hor_ind=rowMeans(cbind(individualism_scale_1, individualism_scale_2,individualism_scale_3,individualism_scale_4))
trolley_proc$ver_ind=rowMeans(cbind(individualism_scale_5, individualism_scale_6,individualism_scale_7,individualism_scale_8))
trolley_proc$hor_col=rowMeans(cbind(individualism_scale_9, individualism_scale_10,individualism_scale_11,individualism_scale_12))
trolley_proc$ver_col=rowMeans(cbind(individualism_scale_13, individualism_scale_14,individualism_scale_15,individualism_scale_16))
detach(trolley_proc)




study2a$lab=as.character(study2a$lab)
study2a$country3=sub("^([A-z]+)_([0-9]+)$", "\\1",  study2a$lab)
study2a$country3=recode(study2a$country3,SWT="CHE", LEB = "LBN", BUL = "BGR", SPA = "ESP")
study2a=merge(study2a, cd, by=c("country3"))

###individualism/collectivism scale
attach(study2a)
study2a$hor_ind=rowMeans(cbind(individualism_scale_1, individualism_scale_2,individualism_scale_3,individualism_scale_4))
study2a$ver_ind=rowMeans(cbind(individualism_scale_5, individualism_scale_6,individualism_scale_7,individualism_scale_8))
study2a$hor_col=rowMeans(cbind(individualism_scale_9, individualism_scale_10,individualism_scale_11,individualism_scale_12))
study2a$ver_col=rowMeans(cbind(individualism_scale_13, individualism_scale_14,individualism_scale_15,individualism_scale_16))
detach(study2a)

study2b$lab=as.character(study2b$lab)
study2b$country3=sub("^([A-z]+)_([0-9]+)$", "\\1",  study2b$lab)
study2b$country3=recode(study2b$country3,SWT="CHE", LEB = "LBN", BUL = "BGR", SPA = "ESP")
study2b=merge(study2b, cd, by=c("country3"))

###individualism/collectivism scale
attach(study2b)
study2b$hor_ind=rowMeans(cbind(individualism_scale_1, individualism_scale_2,individualism_scale_3,individualism_scale_4))
study2b$ver_ind=rowMeans(cbind(individualism_scale_5, individualism_scale_6,individualism_scale_7,individualism_scale_8))
study2b$hor_col=rowMeans(cbind(individualism_scale_9, individualism_scale_10,individualism_scale_11,individualism_scale_12))
study2b$ver_col=rowMeans(cbind(individualism_scale_13, individualism_scale_14,individualism_scale_15,individualism_scale_16))
detach(study2b)

survey=levels(factor(trolley_proc$survey_name))

```

#1. Demographics and exclusion 

<!-- <Tamas> -->


#2. Main replication analysis

##Study 1a

###Bayesian analysis

```{r Study1a Bayesian, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

#use data study1a
tabledata_s1a = data.frame(Exclusion=c(rep("Exclusion",3)),Cluster=c("Eastern", "Southern", "Western"), matrix(nrow=3, ncol=5, dimnames=list(survey,c("BF","RR", "t", "df", "p"))))

for (i in survey){
dat=subset(study1a, survey_name=="PSA006_Western", select=c("trolley_1_rate", "trolley_2_rate"))
dat_long=na.omit(melt(data=dat, variable.name = "condition", value.name="rate"))
datt=as_tibble(ttestBF(formula = rate ~ condition, data=dat_long, rscale=0.26, nullInterval = c(0, Inf)))
tabledata_s1a[i, "BF"]=signif(round(as.numeric(datt[2,1]),1),2)
frequentist=t.test(rate ~ condition, data=dat_long)
tabledata_s1a[i, "t"]=round(frequentist$statistic,2)
tabledata_s1a[i, "df"]=round(frequentist$parameter,2)
tabledata_s1a[i, "p"]=round(frequentist$p.value,4)
}

tabledata_s1a_ne = data.frame(Exclusion=c(rep("No exclusion",3)),Cluster=c("Eastern", "Southern", "Western"), matrix(nrow=3, ncol=5, dimnames=list(survey,c("BF","RR", "t", "df", "p"))))
for (i in survey){
dat=subset(trolley_proc, survey_name==i, select=c("trolley_1_rate", "trolley_2_rate"))
dat_long=na.omit(melt(data=dat, variable.name = "condition", value.name="rate"))
datt=as_tibble(ttestBF(formula = rate ~ condition, data=dat_long, rscale=0.26, nullInterval = c(0, Inf)))
tabledata_s1a_ne[i, "BF"]=signif(round(as.numeric(datt[2,1]),1),2)
frequentist=t.test(rate ~ condition, data=dat_long)
tabledata_s1a_ne[i, "t"]=round(frequentist$statistic,2)
tabledata_s1a_ne[i, "df"]=round(frequentist$parameter,2)
tabledata_s1a_ne[i, "p"]=round(frequentist$p.value,4)
}
studys1a_results = rbind(tabledata_s1a, tabledata_s1a_ne)
rownames(studys1a_results) <- NULL
studys1a_results[,"p"]<-"<.001"

studys1a_results[,"RR"]<-c("1.5e-02, 4.7e+01", "3.0e-08, 9.0e+06", "4.0e-0.3, 1.4e+01", "8.0e-15, 2.0e+13", "1.0e-23, 1.9e+22", "2.0e-19, 6.0e+17")

kbl(
  studys1a_results,
  format = "latex",
  booktabs = T,
  escape=T,
  caption = "The effect of personal force on moral dilemma judgements on Trolley dilemmas",
  centering=T,
  position="H"
  )%>%
  kable_styling( full_width = F,  position="left")%>%
  row_spec(row=0, bold=TRUE)%>%
  collapse_rows(columns = 1, valign = "top", latex_hline = "major", row_group_label_position = "identity")

```

Table S1 and S2 and Figures S1-4 summarise the results of the effect of personal force on moral dilemma judgements, separately for the Speedboat and Trolley dilemmas. First, we conducted the analysis excluding participants based on our exclusion criteria. In this analysis, we replicated the effect of personal force in all cultural clusters, in both the Trolley and Speedboat dilemmas. We also analysed the data without exclusions - in both dilemmas and we arrive at the same conclusion; the effect of personal force on moral judgments is culturally universal; people judge acts that require no personal force more acceptable than acts that do. The “RR” column in the tables indicates the robustness region; a region for the prior with which we would arrive at the same conclusion. This region is very wide, indicating that the results are robust to our prior choices. Although excluding the data of a large number of participants did not change the conclusion, it introduced some noise that differentially affected the cultural clusters. In the western cluster, for example, the t value (effect size) is  smaller if we analyse the data after exclusions, while such difference cannot be observed in the two other cultural clusters.


<!-- //graph with exclusion -->
```{r Study1a excl graph, fig.pos = "H" ,out.width = "80%", fig.cap = "Results on Trolley dilemmas in Study 1 with all exclusion criteria applied. Black full circles indicate group level means.", echo = FALSE, message = FALSE, warning = FALSE, paged.print = FALSE }
# Load violin plot function
source("https://gist.githubusercontent.com/benmarwick/2a1bb0133ff568cbe28d/raw/fb53bd97121f7f9ce947837ef1a4c65a73bffb3f/geom_flat_violin.R")

# Prepare data for plotting
plot_data <- 
  study1a %>% 
  select(survey_name, trolley_1_rate, trolley_2_rate) %>% 
  mutate(survey_name = factor(survey_name)) %>% 
  pivot_longer(
    - survey_name,
    names_to = "condition",
    values_to = "rate") %>% 
  mutate(condition = case_when(condition == "trolley_1_rate" ~ "Personal Force",
                               condition == "trolley_2_rate" ~ "No personal force"),
         condition = factor(condition, levels = c("Personal Force", "No personal force")),
         survey_name = str_remove(survey_name, "PSA006_")) %>% 
  drop_na(rate)

sumld <- 
  plot_data %>% 
  group_by(survey_name, condition) %>% 
  summarise(mean = mean(rate, na.rm = T),
            median = median(rate, na.rm = T),
            sd = sd(rate, na.rm = T),
            lower = mean - sd,
            upper = mean + sd)

# Create plot
plot_data %>% 
  ggplot() +
  aes(
    x = condition,
    y = rate,
    fill = condition) +
  geom_flat_violin(
    position = position_nudge(x = 0, y = 0),
    alpha = .8) +
  #geom_point(aes(y = rate, color = condition), position = position_jitter(width = .15), size = .5, alpha = 0.8) +
  stat_summary(
    fun = mean,
    geom = "line",
    aes(group = 1),
    position = position_nudge(x = 0.1),
    size = 1) +
  geom_line(
    data = sumld,
    aes(x = condition, y = mean),
    position = position_nudge(x = 0.1),
    size = 2.5) +
  geom_point(
    data = sumld,
    aes(x = condition, y = mean),
    position = position_nudge(x = 0.1),
    size = 2.5) +
  #geom_errorbar(data = sumld, aes(ymin = lower, ymax = upper, y = mean), position = position_nudge(x = 0.3), width = 0) +
  guides(fill = FALSE) +
  guides(color = FALSE) +
  scale_fill_viridis_d() +
  facet_wrap(facets = vars(survey_name)) +
  labs(y = "To what extent is this action morally acceptable?") +
  theme_bw() +
  expand_limits(y = c(1,9)) + 
  scale_y_continuous(breaks = 1:9) +
  theme(
    panel.grid.major=element_blank(),
    panel.grid.minor=element_blank(),
    plot.title=element_text(hjust = 0.5, vjust = 0.5, face = "bold", size = 17),
    axis.title.x=element_blank(),
    axis.title.y=element_text(face = "bold", size = 10),
    axis.text.x = element_text(face = "bold", size = 7, colour = "Black"),
    axis.text.y = element_text(face = "bold", size = 12, colour = "Black"),
    legend.title=element_blank(),
    legend.text=element_text(size = 9))
```


<!-- //graph without exclusion -->
```{r Study1a w/o excl graph, fig.pos = "H",out.width = "80%",fig.cap = "Results on Trolley dilemmas in Study 1 with no exclusion criteria applied. Black full circles indicate group level means.", echo = FALSE, message = FALSE, warning = FALSE, paged.print = FALSE }
# Prepare data for plotting
plot_data <- 
  trolley_proc %>% 
  select(survey_name, trolley_1_rate, trolley_2_rate) %>% 
  mutate(survey_name = factor(survey_name)) %>% 
  pivot_longer(
    -survey_name,
    names_to = "condition",
    values_to = "rate") %>% 
  mutate(condition = case_when(condition == "trolley_1_rate" ~ "Personal Force",
                               condition == "trolley_2_rate" ~ "No personal force"),
         condition = factor(condition, levels = c("Personal Force", "No personal force")),
         survey_name = str_remove(survey_name, "PSA006_")) %>% 
  drop_na(rate)

sumld <- 
  plot_data %>% 
  group_by(survey_name, condition) %>% 
  summarise(mean = mean(rate, na.rm = T),
            median = median(rate, na.rm = T),
            sd = sd(rate, na.rm = T),
            lower = mean - sd,
            upper = mean + sd)

# Create plot
plot_data %>% 
  ggplot() +
  aes(
    x = condition,
    y = rate,
    fill = condition) +
  geom_flat_violin(
    position = position_nudge(x = 0, y = 0),
    alpha = .8)+
  #geom_point(aes(y = rate, color = condition), position = position_jitter(width = .15), size = .5, alpha = 0.8) +
  stat_summary(
    fun = mean,
    geom = "line",
    aes(group = 1),
    position = position_nudge(x = 0.1),
    size = 1) +
  geom_line(
    data = sumld,
    aes(x = condition, y = mean),
    position = position_nudge(x = 0.1),
    size = 2.5) +
  geom_point(
    data = sumld,
    aes(x = condition, y = mean),
    position = position_nudge(x = 0.1),
    size = 2.5) +
  guides(fill = FALSE) +
  guides(color = FALSE) +
  scale_fill_viridis_d() +
  facet_wrap(facets = vars(survey_name)) +
  labs(y = "To what extent is this action morally acceptable?") +
  theme_bw() +
  expand_limits(y = c(1,9)) + 
  scale_y_continuous(breaks = 1:9) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_text(hjust = 0.5, vjust = 0.5, face = "bold", size = 17),
    axis.title.x = element_blank(),
    axis.title.y = element_text(face = "bold", size = 10),
    axis.text.x = element_text(face = "bold", size = 7, colour = "Black"),
    axis.text.y = element_text(face = "bold", size = 12, colour = "Black"),
    legend.title = element_blank(),
    legend.text = element_text(size = 9))
```

```{r Study1b Bayesian, echo=FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}

survey=levels(factor(trolley_proc$survey_name))
tabledata_s1b = data.frame(Exclusion=c(rep("Exclusion",3)),Cluster=c("Eastern", "Southern", "Western"), matrix(nrow=3, ncol=5, dimnames=list(survey,c("BF","RR", "t", "df", "p"))))

for (i in survey){
dat=subset(study1b, survey_name==i, select=c("speedboat_1_rate", "speedboat_2_rate"))
dat_long=na.omit(melt(data=dat, variable.name = "condition", value.name="rate"))
datt=as_tibble(ttestBF(formula = rate ~ condition, data=dat_long, rscale=0.26, nullInterval = c(0, Inf)))
tabledata_s1b[i, "BF"]=signif(round(as.numeric(datt[2,1]),1),2)
frequentist=t.test(rate ~ condition, data=dat_long)
tabledata_s1b[i, "t"]=round(frequentist$statistic,2)
tabledata_s1b[i, "df"]=round(frequentist$parameter,2)
tabledata_s1b[i, "p"]=round(frequentist$p.value,3)
}

tabledata_s1b_ne = data.frame(Exclusion=c(rep("No exclusion",3)),Cluster=c("Eastern", "Southern", "Western"), matrix(nrow=3, ncol=5, dimnames=list(survey,c("BF","RR", "t", "df", "p"))))
for (i in survey){
dat=subset(trolley_proc, survey_name==i, select=c("speedboat_1_rate", "speedboat_2_rate"))
dat_long=na.omit(melt(data=dat, variable.name = "condition", value.name="rate"))
datt=as_tibble(ttestBF(formula = rate ~ condition, data=dat_long, rscale=0.26, nullInterval = c(0, Inf)))
tabledata_s1b_ne[i, "BF"]=signif(round(as.numeric(datt[2,1]),1),2)
frequentist=t.test(rate ~ condition, data=dat_long)
tabledata_s1b_ne[i, "t"]=round(frequentist$statistic,2)
tabledata_s1b_ne[i, "df"]=round(frequentist$parameter,2)
tabledata_s1b_ne[i, "p"]=round(frequentist$p.value,3)
}
studys1b_results = rbind(tabledata_s1b, tabledata_s1b_ne)
rownames(studys1b_results) <- NULL
studys1b_results[studys1b_results==0.000]<-"<.001"

studys1b_results[,"RR"]<-c("2.6e-06, 5.7e+04", "3.0e-04, 2.5e+03", "6.0e-03, 4.3", "8.4e-10, 1.1e+08", "5.8e-18, 2.2e+16", "8.0e-18, 1.2e+16")

kbl(
  studys1b_results,
  format = "latex",
  booktabs = T,
  escape=T,
  caption = " The effect of personal force on moral dilemma judgements on Speedboat dilemmas",
  centering=T,
  position="H"
  )%>%
  kable_styling( full_width = F,  position="left")%>%
  row_spec(row=0, bold=TRUE)%>%
  collapse_rows(columns = 1, valign = "top", latex_hline = "major", row_group_label_position = "identity")
```


<!-- //graph with exclusion -->
```{r Study1b excl graph, fig.pos="H",out.width="80%",fig.cap="Results on Trolley dilemmas in Study 1 with all exclusion criteria applied. Black full circles indicate group level means.", echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE }
# Prepare data for plotting
plot_data <- 
  study1b %>% 
  select(survey_name, speedboat_1_rate, speedboat_2_rate) %>% 
  mutate(survey_name = factor(survey_name)) %>% 
  pivot_longer(
    -survey_name,
    names_to = "condition",
    values_to = "rate") %>% 
  mutate(condition = case_when(condition == "speedboat_1_rate" ~ "Personal Force",
                               condition == "speedboat_2_rate" ~ "No personal force"),
         condition = factor(condition, levels = c("Personal Force", "No personal force")),
         survey_name = str_remove(survey_name, "PSA006_")) %>% 
  drop_na(rate)

sumld <- 
  plot_data %>% 
  group_by(survey_name, condition) %>% 
  summarise(mean = mean(rate, na.rm = T),
            median = median(rate, na.rm = T),
            sd = sd(rate, na.rm = T),
            lower = mean - sd,
            upper = mean + sd)

# Create plot
plot_data %>% 
  ggplot() +
  aes(
    x = condition,
    y = rate,
    fill = condition) +
  geom_flat_violin(
    position = position_nudge(x = 0, y = 0),
    alpha = .8)+
  #geom_point(aes(y = rate, color = condition), position = position_jitter(width = .15), size = .5, alpha = 0.8) +
  stat_summary(
    fun = mean,
    geom = "line",
    aes(group = 1),
    position = position_nudge(x = 0.1),
    size = 1) +
  geom_line(
    data = sumld,
    aes(x = condition, y = mean),
    position = position_nudge(x = 0.1),
    size = 2.5) +
  geom_point(
    data = sumld,
    aes(x = condition, y = mean),
    position = position_nudge(x = 0.1),
    size = 2.5) +
  guides(fill = FALSE) +
  guides(color = FALSE) +
  scale_fill_viridis_d() +
  facet_wrap(facets = vars(survey_name)) +
  labs(y = "To what extent is this action morally acceptable?") +
  theme_bw() +
  expand_limits(y = c(1,9)) + 
  scale_y_continuous(breaks = 1:9) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_text(hjust = 0.5, vjust = 0.5, face = "bold", size = 17),
    axis.title.x = element_blank(),
    axis.title.y = element_text(face = "bold", size = 10),
    axis.text.x = element_text(face = "bold", size = 7, colour = "Black"),
    axis.text.y = element_text(face = "bold", size = 12, colour = "Black"),
    legend.title = element_blank(),
    legend.text = element_text(size = 9))
```


<!-- //graph without exclusion -->
```{r Study1b w/o excl graph, fig.pos="H",out.width="80%",fig.cap="Results on Speedboat dilemmas in Study 1 with no exclusion criteria applied. Black full circles indicate group level means.", echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE }
# Prepare data for plotting
plot_data <- 
  trolley_proc %>% 
  select(survey_name, speedboat_1_rate, speedboat_2_rate) %>% 
  mutate(survey_name = factor(survey_name)) %>% 
  pivot_longer(
    -survey_name,
    names_to = "condition",
    values_to = "rate") %>% 
  mutate(condition = case_when(condition == "speedboat_1_rate" ~ "Personal Force",
                               condition == "speedboat_2_rate" ~ "No personal force"),
         condition = factor(condition, levels = c("Personal Force", "No personal force")),
         survey_name = str_remove(survey_name, "PSA006_")) %>% 
  drop_na(rate)

sumld <- 
  plot_data %>% 
  group_by(survey_name, condition) %>% 
  summarise(mean = mean(rate, na.rm = T),
            median = median(rate, na.rm = T),
            sd = sd(rate, na.rm = T),
            lower = mean - sd,
            upper = mean + sd)

# Create plot
plot_data %>% 
  ggplot() +
  aes(
    x = condition,
    y = rate,
    fill = condition) +
  geom_flat_violin(
    position = position_nudge(x = 0, y = 0),
    alpha = .8)+
  #geom_point(aes(y = rate, color = condition), position = position_jitter(width = .15), size = .5, alpha = 0.8) +
  stat_summary(
    fun = mean,
    geom = "line",
    aes(group = 1),
    position = position_nudge(x = 0.1),
    size = 1) +
  geom_line(
    data = sumld,
    aes(x = condition, y = mean),
    position = position_nudge(x = 0.1),
    size = 2.5) +
  geom_point(
    data = sumld,
    aes(x = condition, y = mean),
    position = position_nudge(x = 0.1),
    size = 2.5) +
  guides(fill = FALSE) +
  guides(color = FALSE) +
  scale_fill_viridis_d() +
  facet_wrap(facets = vars(survey_name)) +
  labs(y = "To what extent is this action morally acceptable?") +
  theme_bw() +
  expand_limits(y = c(1,9)) + 
  scale_y_continuous(breaks = 1:9) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_text(hjust = 0.5, vjust = 0.5, face = "bold", size = 17),
    axis.title.x = element_blank(),
    axis.title.y = element_text(face = "bold", size = 10),
    axis.text.x = element_text(face = "bold", size = 7, colour = "Black"),
    axis.text.y = element_text(face = "bold", size = 12, colour = "Black"),
    legend.title = element_blank(),
    legend.text = element_text(size = 9))
```


##Study 2a and 2b

We analysed the interactional effect of personal force and intention in a similar way (Tables S3 and S4, Figures S5-S8). We treatment coded both personal force (0 = no personal force; 1 = personal force) and intention (0 = no intention; 1 = intention) and added them to the model. In the Bayesian analysis, the Bayes factor represents the ratio of two Bayesian regression models (we always used the same priors for these models): the denominator model, a model with the two main effects but without the critical two-way interaction, and in the numerator the full model including the interaction term. In case of the trolley dilemmas, we have strong evidence (BF >10) to conclude that the interaction exists in the Western and Southern cultural clusters, while in the Eastern cluster results are inconclusive ( 1/10 < BF < 10). Here, we believe is again a case of selection bias. When we analysed all the data, without exclusions, we replicated the effect in all cultural clusters (BF > 10). The evidence however is more mixed for the Speedboat dilemmas. Here, we found evidence only for the interaction on the Western cluster but we did not find an effect on the other two clusters. Although the BF goes below only our null threshold (eastern cluster - without exclusions), BF < 1 in this case makes the null hypothesis more likely than the alternative one.


```{r Study2a Bayesian, echo=FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}

tabledata_s2a = data.frame(Exclusion=c(rep("Exclusion",3)),Cluster=c("Eastern", "Southern", "Western"), matrix(nrow=3, ncol=5, dimnames=list(survey,c("BF","RR", "F", "df", "p"))))

for (i in survey){
dat=subset(study2a, survey_name==i, select=c("trolley_3_rate", "trolley_4_rate", "trolley_5_rate", "trolley_6_rate"))
dat_long=na.omit(melt(data=dat, variable.name = "condition", value.name="rate"))
dat_long$personal_force = factor(ifelse(dat_long$condition=="trolley_3_rate"|dat_long$condition=="trolley_5_rate", 0, 1))
dat_long$intention = factor(ifelse(dat_long$condition=="trolley_4_rate"|dat_long$condition=="trolley_5_rate", 1, 0))
datt=lmBF(rate ~ personal_force*intention, data=dat_long, rscaleFixed=c("personal_force:intention"=0.19))
datt2=lmBF(rate ~ personal_force+intention, data=dat_long)
datt3=as_tibble(datt/datt2)
tabledata_s2a[i, "BF"]=signif(round(datt3[1,1],1),2)
frequentist=summary(aov(rate ~ personal_force*intention, data=dat_long))[[1]]
tabledata_s2a[i, "F"]=round(frequentist[3, "F value"],3)
tabledata_s2a[i, "df"]=paste("1, ", frequentist[4, "Df"])
tabledata_s2a[i, "p"]=round(frequentist[3, "Pr(>F)"],3)
}

tabledata_s2a_ne = data.frame(Exclusion=c(rep("No exclusion",3)),Cluster=c("Eastern", "Southern", "Western"), matrix(nrow=3, ncol=5, dimnames=list(survey,c("BF","RR", "F", "df", "p"))))
for (i in survey){
dat=subset(trolley_proc, survey_name==i, select=c("trolley_3_rate", "trolley_4_rate", "trolley_5_rate", "trolley_6_rate"))
dat_long=na.omit(melt(data=dat, variable.name = "condition", value.name="rate"))
dat_long$personal_force = factor(ifelse(dat_long$condition=="trolley_3_rate"|dat_long$condition=="trolley_5_rate", 0, 1))
dat_long$intention = factor(ifelse(dat_long$condition=="trolley_4_rate"|dat_long$condition=="trolley_5_rate", 1, 0))
datt=lmBF(rate ~ personal_force*intention, data=dat_long, rscaleFixed=c("personal_force:intention"=0.19))
datt2=lmBF(rate ~ personal_force+intention, data=dat_long)
datt3=as_tibble(datt/datt2)
tabledata_s2a_ne[i, "BF"]=signif(round(datt3[1,1],1),2)
frequentist=summary(aov(rate ~ personal_force*intention, data=dat_long))[[1]]
tabledata_s2a_ne[i, "F"]=round(frequentist[3, "F value"],3)
tabledata_s2a_ne[i, "df"]=paste("1, ", frequentist[4, "Df"])
tabledata_s2a_ne[i, "p"]=round(frequentist[3, "Pr(>F)"],3)
}
studys2a_results = rbind(tabledata_s2a, tabledata_s2a_ne)
rownames(studys2a_results) <- NULL
studys2a_results[studys2a_results==0.000]<-"<.001"
studys2a_results[,"RR"]<-c("2.2e-01, Inf", "1.3e-0.2, 2.3", "<1.0e-04, 3.1e+10", "2.7e-0.4, 1.1e+03", "<1.0e-04, 8.9e+15", "<1.0e-04, >1.0e+18")


kbl(
  studys2a_results,
  format = "latex",
  booktabs = T,
  escape=T,
  caption = "Do personal force interact with intention on Trolley dilemmas?",
  centering=T,
  position="H"
  )%>%
  kable_styling( full_width = F,  position="left")%>%
  row_spec(row=0, bold=TRUE)%>%
  collapse_rows(columns = 1, valign = "top", latex_hline = "major", row_group_label_position = "identity")

```


<!-- //graph with exclusion -->
```{r Study2a excl graph,fig.pos="H",out.width="80%",fig.cap="Results on Trolley dilemmas in Study 2 when all exclusion criteria are applied. Error bars are 95\\% confidence intervals on the mean.", echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE }
# Prepare data for plotting
plot_data <- 
  study2a %>% 
  select(survey_name, trolley_3_rate, trolley_4_rate, trolley_5_rate, trolley_6_rate) %>% 
  mutate(survey_name = factor(survey_name)) %>% 
  pivot_longer(
    -survey_name,
    names_to = "condition",
    values_to = "rate") %>% 
  mutate(personal_force = case_when(condition == "trolley_3_rate" ~ "No Personal Force",
                                    condition == "trolley_4_rate" ~ "Personal force",
                                    condition == "trolley_5_rate" ~ "No Personal Force",
                                    condition == "trolley_6_rate" ~ "Personal force"),
         intention = case_when(condition == "trolley_3_rate" ~ "No Intention",
                               condition == "trolley_4_rate" ~ "Intention",
                               condition == "trolley_5_rate" ~ "Intention",
                               condition == "trolley_6_rate" ~ "No Intention"),
         intention = factor(intention, levels = c("No Intention", "Intention")),
         survey_name = str_remove(survey_name, "PSA006_")) %>% 
  drop_na(rate)

# Create plot
plot_data %>% 
  ggplot() +
  aes(
    x = intention,
    y = rate,
    fill = personal_force,
    width = 0.7) +
  stat_summary(
    fun = mean,
    geom = "bar",
    position = "dodge",
    colour = "Black",
    width = 1.2) +
  stat_summary(
    fun.data = mean_cl_boot,
    geom = "errorbar",
    position = position_dodge(width = 0.7),
    colour = "Black",
    width = 0.2) +
  scale_fill_viridis_d() +
  facet_wrap(facets=vars(survey_name)) +
  labs(y = "To what extent is this action morally acceptable?") +
  theme_bw() +
  expand_limits(y = c(1,9)) +
  scale_y_continuous(breaks = 1:9) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_text(hjust = 0.5, vjust = 0.5, face = "bold", size = 17),
    axis.title.x = element_blank(),
    axis.title.y = element_text(face = "bold", size = 10),
    axis.text.x = element_text(face = "bold", size = 7, colour = "Black"),
    axis.text.y = element_text(face = "bold", size = 12, colour = "Black"),
    legend.title = element_blank(),
    legend.text = element_text(size = 9))
```

<!-- //graph without exclusion -->
```{r Study2a w/o excl graph, fig.pos="H",out.width="80%",fig.cap="Results on Trolley dilemmas in Study 2 when no exclusion criteria are applied. Error bars are 95\\% confidence intervals on the mean. ",  echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE }
# Prepare data for plotting
plot_data <- 
  trolley_proc %>% 
  select(survey_name, trolley_3_rate, trolley_4_rate, trolley_5_rate, trolley_6_rate) %>% 
  mutate(survey_name = factor(survey_name)) %>% 
  pivot_longer(
    -survey_name,
    names_to = "condition",
    values_to = "rate") %>% 
  mutate(personal_force = case_when(condition == "trolley_3_rate" ~ "No Personal Force",
                                    condition == "trolley_4_rate" ~ "Personal force",
                                    condition == "trolley_5_rate" ~ "No Personal Force",
                                    condition == "trolley_6_rate" ~ "Personal force"),
         intention = case_when(condition == "trolley_3_rate" ~ "No Intention",
                               condition == "trolley_4_rate" ~ "Intention",
                               condition == "trolley_5_rate" ~ "Intention",
                               condition == "trolley_6_rate" ~ "No Intention"),
         intention = factor(intention, levels = c("No Intention", "Intention")),
         survey_name = str_remove(survey_name, "PSA006_")) %>% 
  drop_na(rate)

# Create plot
plot_data %>% 
  ggplot() +
  aes(
    x = intention,
    y = rate,
    fill = personal_force,
    width = 0.7) +
  stat_summary(
    fun = mean,
    geom = "bar",
    position = "dodge",
    colour = "Black",
    width = 1.2) +
  stat_summary(
    fun.data = mean_cl_boot,
    geom = "errorbar",
    position = position_dodge(width = 0.7),
    colour = "Black",
    width = 0.2) +
  scale_fill_viridis_d() +
  facet_wrap(facets=vars(survey_name)) +
  labs(y = "To what extent is this action morally acceptable?") +
  theme_bw() +
  expand_limits(y = c(1,9)) +
  scale_y_continuous(breaks = 1:9) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_text(hjust = 0.5, vjust = 0.5, face = "bold", size = 17),
    axis.title.x = element_blank(),
    axis.title.y = element_text(face = "bold", size = 10),
    axis.text.x = element_text(face = "bold", size = 7, colour = "Black"),
    axis.text.y = element_text(face = "bold", size = 12, colour = "Black"),
    legend.title = element_blank(),
    legend.text = element_text(size = 9))
```

```{r study2b Bayesian, echo=FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}
tabledata_s2b = data.frame(Exclusion=c(rep("Exclusion",3)),Cluster=c("Eastern", "Southern", "Western"), matrix(nrow=3, ncol=5, dimnames=list(survey,c("BF","RR", "F", "df", "p"))))
##ggrepel grom_text repel
for (i in survey){
dat=subset(study2b, survey_name==i, select=c("speedboat_3_rate", "speedboat_4_rate", "speedboat_5_rate", "speedboat_6_rate"))
dat_long=na.omit(melt(data=dat, variable.name = "condition", value.name="rate"))
dat_long$personal_force = factor(ifelse(dat_long$condition=="speedboat_3_rate"|dat_long$condition=="speedboat_5_rate", 0, 1))
dat_long$intention = factor(ifelse(dat_long$condition=="speedboat_4_rate"|dat_long$condition=="speedboat_5_rate", 1, 0))
datt=lmBF(rate ~ personal_force*intention, data=dat_long, rscaleFixed=0.26)
datt2=lmBF(rate ~ personal_force+intention, data=dat_long, rscaleFixed=0.26)
datt3=as_tibble(datt/datt2)
tabledata_s2b[i, "BF"]=signif(round(datt3[1,1],1),2)
frequentist=summary(aov(rate ~ personal_force*intention, data=dat_long))[[1]]
tabledata_s2b[i, "F"]=round(frequentist[3, "F value"],3)
tabledata_s2b[i, "df"]=paste("1, ", frequentist[4, "Df"])
tabledata_s2b[i, "p"]=round(frequentist[3, "Pr(>F)"],3)
}

tabledata_s2b_ne = data.frame(Exclusion=c(rep("No exclusion",3)),Cluster=c("Eastern", "Southern", "Western"), matrix(nrow=3, ncol=5, dimnames=list(survey,c("BF","RR", "F", "df", "p"))))
for (i in survey){
dat=subset(trolley_proc, survey_name==i, select=c("speedboat_3_rate", "speedboat_4_rate", "speedboat_5_rate", "speedboat_6_rate"))
dat_long=na.omit(melt(data=dat, variable.name = "condition", value.name="rate"))
dat_long$personal_force = factor(ifelse(dat_long$condition=="speedboat_3_rate"|dat_long$condition=="speedboat_5_rate", 0, 1))
dat_long$intention = factor(ifelse(dat_long$condition=="speedboat_4_rate"|dat_long$condition=="speedboat_5_rate", 1, 0))
datt=lmBF(rate ~ personal_force*intention, data=dat_long, rscaleFixed=0.26)
datt2=lmBF(rate ~ personal_force+intention, data=dat_long, rscaleFixed=0.26)
datt3=as_tibble(datt/datt2)
tabledata_s2b_ne[i, "BF"]=signif(round(datt3[1,1],1),2)
frequentist=summary(aov(rate ~ personal_force*intention, data=dat_long))[[1]]
tabledata_s2b_ne[i, "F"]=round(frequentist[3, "F value"],3)
tabledata_s2b_ne[i, "df"]=paste("1, ", frequentist[4, "Df"])
tabledata_s2b_ne[i, "p"]=round(frequentist[3, "Pr(>F)"],3)
}
studys2b_results = rbind(tabledata_s2b, tabledata_s2b_ne)
rownames(studys2b_results) <- NULL
studys2b_results[studys2b_results==0.000]<-"<.001"
studys2b_results[,"RR"]<-c("0, 2.8e-0.1", "2.2e-01, Inf", "1.2e-03, 1.5e+01, 3.1e+10", "8.0e-02, Inf", "0, 3.5e-01", "2.0e-0.3, 7.8e-01")


kbl(
  studys2b_results,
  format = "latex",
  booktabs = T,
  escape=T,
  caption = "Do personal force interact with intention on Speedboat dilemmas?",
  centering=T,
  position="H"
  )%>%
  kable_styling( full_width = F,  position="left")%>%
  row_spec(row=0, bold=TRUE)%>%
  collapse_rows(columns = 1, valign = "top", latex_hline = "major", row_group_label_position = "identity")
```

<!-- //graph with exclusion -->
```{r study2b excl graph, fig.pos="H",out.width="80%",fig.cap="Results on the Speedboat dilemmas in Study 2 when all exclusion criteria are applied. Error bars are 95\\% confidence intervals on the mean.",  echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE }
# Prepare data for plotting
plot_data <- 
  study2b %>% 
  select(survey_name, speedboat_3_rate, speedboat_4_rate, speedboat_5_rate, speedboat_6_rate) %>% 
  mutate(survey_name = factor(survey_name)) %>% 
  pivot_longer(
    -survey_name,
    names_to = "condition",
    values_to = "rate") %>% 
  mutate(personal_force = case_when(condition == "speedboat_3_rate" ~ "No Personal Force",
                                    condition == "speedboat_4_rate" ~ "Personal force",
                                    condition == "speedboat_5_rate" ~ "No Personal Force",
                                    condition == "speedboat_6_rate" ~ "Personal force"),
         intention = case_when(condition == "speedboat_3_rate" ~ "No Intention",
                               condition == "speedboat_4_rate" ~ "Intention",
                               condition == "speedboat_5_rate" ~ "Intention",
                               condition == "speedboat_6_rate" ~ "No Intention"),
         intention = factor(intention, levels = c("No Intention", "Intention")),
         survey_name = str_remove(survey_name, "PSA006_")) %>% 
  drop_na(rate)

# Create plot
plot_data %>% 
  ggplot() +
  aes(
    x = intention,
    y = rate,
    fill = personal_force,
    width = 0.7) +
  stat_summary(
    fun = mean,
    geom = "bar",
    position = "dodge",
    colour = "Black",
    width = 1.2) +
  stat_summary(
    fun.data = mean_cl_boot,
    geom = "errorbar",
    position = position_dodge(width = 0.7),
    colour = "Black",
    width = 0.2) +
  scale_fill_viridis_d() +
  facet_wrap(facets=vars(survey_name)) +
  labs(y = "To what extent is this action morally acceptable?") +
  theme_bw() +
  expand_limits(y = c(1,9)) +
  scale_y_continuous(breaks = 1:9) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_text(hjust = 0.5, vjust = 0.5, face = "bold", size = 17),
    axis.title.x = element_blank(),
    axis.title.y = element_text(face = "bold", size = 10),
    axis.text.x = element_text(face = "bold", size = 7, colour = "Black"),
    axis.text.y = element_text(face = "bold", size = 12, colour = "Black"),
    legend.title = element_blank(),
    legend.text = element_text(size = 9))
```


<!-- //graph without exclusion -->
```{r study2b w/o excl graph,fig.pos="H",out.width="80%",fig.cap="Results on the Speedboat dilemmas in Study 2 when no exclusion criteria is applied. Error bars are 95\\% confidence intervals on the mean.", echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE }
# Prepare data for plotting
plot_data <- 
  trolley_proc %>% 
  select(survey_name, speedboat_3_rate, speedboat_4_rate, speedboat_5_rate, speedboat_6_rate) %>% 
  mutate(survey_name = factor(survey_name)) %>% 
  pivot_longer(
    -survey_name,
    names_to = "condition",
    values_to = "rate") %>% 
  mutate(personal_force = case_when(condition == "speedboat_3_rate" ~ "No Personal Force",
                                    condition == "speedboat_4_rate" ~ "Personal force",
                                    condition == "speedboat_5_rate" ~ "No Personal Force",
                                    condition == "speedboat_6_rate" ~ "Personal force"),
         intention = case_when(condition == "speedboat_3_rate" ~ "No Intention",
                               condition == "speedboat_4_rate" ~ "Intention",
                               condition == "speedboat_5_rate" ~ "Intention",
                               condition == "speedboat_6_rate" ~ "No Intention"),
         intention = factor(intention, levels = c("No Intention", "Intention")),
         survey_name = str_remove(survey_name, "PSA006_")) %>% 
  drop_na(rate)

# Create plot
plot_data %>% 
  ggplot() +
  aes(
    x = intention,
    y = rate,
    fill = personal_force,
    width = 0.7) +
  stat_summary(
    fun = mean,
    geom = "bar",
    position = "dodge",
    colour = "Black",
    width = 1.2) +
  stat_summary(
    fun.data = mean_cl_boot,
    geom = "errorbar",
    position = position_dodge(width = 0.7),
    colour = "Black",
    width = 0.2) +
  scale_fill_viridis_d() +
  facet_wrap(facets=vars(survey_name)) +
  labs(y = "To what extent is this action morally acceptable?") +
  theme_bw() +
  expand_limits(y = c(1,9)) +
  scale_y_continuous(breaks = 1:9) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_text(hjust = 0.5, vjust = 0.5, face = "bold", size = 17),
    axis.title.x = element_blank(),
    axis.title.y = element_text(face = "bold", size = 10),
    axis.text.x = element_text(face = "bold", size = 7, colour = "Black"),
    axis.text.y = element_text(face = "bold", size = 12, colour = "Black"),
    legend.title = element_blank(),
    legend.text = element_text(size = 9))
```

The initial idea behind the exclusion critria was that by excluding certain people, we decrease noise and, as a result, we avoid false negative effects. For example, we thought that people failing the attention check questions do not paid enough attention to the task, or that people who were familiar with the trolley problem would respond with their knowledge of the trolley problem in mind, and that would result in a decreased effect of personal force. We observed the complete opposite; we observed a bigger effect size if there was no participants excluded in all cases previously analysed. This could mean either an increased random noise due to the decreased N, or a systematic bias that was intrudiced by a large number of exclusions (85% excluded overall). Hence, to avoid such biases, from this point, we applied no exclusion criteria. 

#3. Individualism-collectivism analysis
##With all exclusions
<!-- Bayesian country level individualism w exclusion -->
```{r analysis individual + country level study 2a exclusion, echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}
#for loop changes predictor variables
#table has 5lines: country level individualism, then individual level measures

vars=c("Collectivism", "ver_ind", "hor_ind", "ver_col", "hor_col")
tabledata_s2a_ind = data.frame(variable=c("Country-level collectivism", "Vertical Individualism", "Horizontal Individualism", "Vertical Collectivism", "Horizontal Collectivism"), matrix(nrow=5, ncol=3, dimnames=list(vars,c("BF", "b",  "p"))))


dat=subset(study2a,  select=c("trolley_3_rate", "trolley_4_rate", "trolley_5_rate", "trolley_6_rate", "country3", vars))
dat_long=na.omit(melt(data=dat, variable.name = "condition", value.name="rate", id.vars=c(vars, "country3")))
dat_long$personal_force = factor(ifelse(dat_long$condition=="trolley_3_rate"|dat_long$condition=="trolley_5_rate", 0, 1))
dat_long$intention = factor(ifelse(dat_long$condition=="trolley_4_rate"|dat_long$condition=="trolley_5_rate", 1, 0))
dat_long$country3=as.character(dat_long$country3)
dat_long$country3=factor(paste0("0", dat_long$country3))

graphdata=data.frame(variable=c("Country-level collectivism", "Vertical Individualism", "Horizontal Individualism", "Vertical Collectivism", "Horizontal Collectivism"), matrix(nrow=5, ncol=3, dimnames=list(vars,c("b",  "lower", "higher"))))

for (i in vars){
  if(i=="Collectivism"){
  datt=lmBF(rate ~   personal_force*intention*Collectivism + country3, data=dat_long, whichRandom="country3",rscaleCont = c("personal_force:intention:Collectivism" = 0.19))
  datt2=lmBF(rate ~  personal_force+intention+Collectivism+personal_force:Collectivism+personal_force:intention+intention:Collectivism+country3, whichRandom="country3",data=dat_long)  
  frequentist_m=lmer(rate ~ personal_force*intention*Collectivism +(1|country3), data=dat_long)
  frequentist=broom.mixed::tidy(frequentist_m)
  } else if(i=="ver_ind"){
  datt=lmBF(rate ~   personal_force*intention*ver_ind+country3, data=dat_long,  whichRandom="country3",  rscaleCont = c("personal_force:intention:ver_ind" = 0.19))
  datt2=lmBF(rate ~ personal_force+intention+ver_ind+personal_force:ver_ind+personal_force:intention+intention:ver_ind +country3,  whichRandom="country3", data=dat_long)  
  frequentist_m=lmer(rate ~ personal_force*intention*ver_ind +(1|country3), data=dat_long)
  frequentist=broom.mixed::tidy(frequentist_m)
  }else if(i=="hor_ind"){
  datt=lmBF(rate ~   personal_force*intention*hor_ind+country3, data=dat_long,  whichRandom="country3", rscaleFixed=0.26, rscaleCont = c("personal_force:intention:hor_ind" = 0.19))
  datt2=lmBF(rate ~  personal_force+intention+hor_ind+personal_force:hor_ind+personal_force:intention+intention:hor_ind+country3,  whichRandom="country3", data=dat_long)  
  frequentist_m=lmer(rate ~ personal_force*intention*hor_ind +(1|country3), data=dat_long)
  frequentist=broom.mixed::tidy(frequentist_m)
  }else if(i=="ver_col"){
  datt=lmBF(rate ~   personal_force*intention*ver_col+country3, data=dat_long,  whichRandom="country3", rscaleCont = c("personal_force:intention:ver_col" = 0.19))
  datt2=lmBF(rate ~  personal_force+intention+ver_col+personal_force:ver_col+personal_force:intention+intention:ver_col +country3,  whichRandom="country3",  data=dat_long)  
  frequentist_m=lmer(rate ~ personal_force*intention*ver_col +(1|country3), data=dat_long)
  frequentist=broom.mixed::tidy(frequentist_m)
  }else if(i=="hor_col"){
  datt=lmBF(rate ~  personal_force*intention*hor_col+country3, data=dat_long, whichRandom="country3", rscaleCont = c("personal_force:intention:hor_col" = 0.19))
  datt2=lmBF(rate ~  personal_force+intention+hor_col+personal_force:hor_col+personal_force:intention+intention:hor_col +country3,  whichRandom="country3",   data=dat_long)  
  frequentist_m=lmer(rate ~ personal_force*intention*hor_col +(1|country3), data=dat_long)
  frequentist=broom.mixed::tidy(frequentist_m)
  }
datt3=as_tibble(datt/datt2)
tabledata_s2a_ind[i, "BF"]=signif(datt3[1,1],4)
tabledata_s2a_ind[i, "b"]=round(frequentist[8, "estimate"],3)
tabledata_s2a_ind[i, "p"]=round(frequentist[8, "p.value"],3)
graphdata[i, "b"]=round(frequentist[8, "estimate"],3)
graphdata[i, "lower"]=round(confint(frequentist_m),2)[10,1]
graphdata[i, "higher"]=round(confint(frequentist_m),2)[10,2]

}

graphdata=graphdata[-1,]
rownames(tabledata_s2a_ind) <- NULL


kbl(
  tabledata_s2a_ind,
  format = "latex",
  booktabs = T,
  escape=T,
  caption = "Is the interaction of personal force and intention affected by individualism/collectivism on Trolley dilemmas whhen all exclusion criteria is applied?",
  centering=T,
  position="H"
  )%>%
  kable_styling( full_width = F,  position="left")%>%
  row_spec(row=0, bold=TRUE)

```


<!-- Bayesian country level individualism w exclusion -->
```{r analysis individual + country level study 2b exclusion, echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}
#for loop changes predictor variables
#table has 5lines: country level individualism, then individual level measures

vars=c("Collectivism", "ver_ind", "hor_ind", "ver_col", "hor_col")
tabledata_s2b_ind = data.frame(variable=c("Country-level collectivism", "Vertical Individualism", "Horizontal Individualism", "Vertical Collectivism", "Horizontal Collectivism"), matrix(nrow=5, ncol=3, dimnames=list(vars,c("BF", "b",  "p"))))

graphdata=data.frame(variable=c("Country-level collectivism", "Vertical Individualism", "Horizontal Individualism", "Vertical Collectivism", "Horizontal Collectivism"), matrix(nrow=5, ncol=3, dimnames=list(vars,c("b",  "lower", "higher"))))


dat=subset(study2b,  select=c("speedboat_3_rate", "speedboat_4_rate", "speedboat_5_rate", "speedboat_6_rate", "country3", vars))
dat_long=na.omit(melt(data=dat, variable.name = "condition", value.name="rate", id.vars=c(vars, "country3")))
dat_long$personal_force = factor(ifelse(dat_long$condition=="speedboat_3_rate"|dat_long$condition=="speedboat_5_rate", 0, 1))
dat_long$intention = factor(ifelse(dat_long$condition=="speedboat_4_rate"|dat_long$condition=="speedboat_5_rate", 1, 0))
dat_long$country3=as.character(dat_long$country3)
dat_long$country3=factor(paste0("0", dat_long$country3))


for (i in vars){
  if(i=="Collectivism"){
  datt=lmBF(rate ~   personal_force*intention*Collectivism + country3, data=dat_long, whichRandom="country3",rscaleCont = c("personal_force:intention:Collectivism" = 0.19))
  datt2=lmBF(rate ~  personal_force+intention+Collectivism+personal_force:Collectivism+personal_force:intention+intention:Collectivism+country3, whichRandom="country3",data=dat_long)  
  frequentist_m=lmer(rate ~ personal_force*intention*Collectivism +(1|country3), data=dat_long)
  frequentist=broom.mixed::tidy(frequentist_m)
  } else if(i=="ver_ind"){
  datt=lmBF(rate ~   personal_force*intention*ver_ind+country3, data=dat_long,  whichRandom="country3",  rscaleCont = c("personal_force:intention:ver_ind" = 0.19))
  datt2=lmBF(rate ~ personal_force+intention+ver_ind+personal_force:ver_ind+personal_force:intention+intention:ver_ind +country3,  whichRandom="country3", data=dat_long)  
  frequentist_m=lmer(rate ~ personal_force*intention*ver_ind +(1|country3), data=dat_long)
  frequentist=broom.mixed::tidy(frequentist_m)
  }else if(i=="hor_ind"){
  datt=lmBF(rate ~   personal_force*intention*hor_ind+country3, data=dat_long,  whichRandom="country3", rscaleFixed=0.26, rscaleCont = c("personal_force:intention:hor_ind" = 0.19))
  datt2=lmBF(rate ~  personal_force+intention+hor_ind+personal_force:hor_ind+personal_force:intention+intention:hor_ind+country3,  whichRandom="country3", data=dat_long)  
  frequentist_m=lmer(rate ~ personal_force*intention*hor_ind +(1|country3), data=dat_long)
  frequentist=broom.mixed::tidy(frequentist_m)
  }else if(i=="ver_col"){
  datt=lmBF(rate ~   personal_force*intention*ver_col+country3, data=dat_long,  whichRandom="country3", rscaleCont = c("personal_force:intention:ver_col" = 0.19))
  datt2=lmBF(rate ~  personal_force+intention+ver_col+personal_force:ver_col+personal_force:intention+intention:ver_col +country3,  whichRandom="country3",  data=dat_long)  
  frequentist_m=lmer(rate ~ personal_force*intention*ver_col +(1|country3), data=dat_long)
  frequentist=broom.mixed::tidy(frequentist_m)
  }else if(i=="hor_col"){
  datt=lmBF(rate ~  personal_force*intention*hor_col+country3, data=dat_long, whichRandom="country3", rscaleCont = c("personal_force:intention:hor_col" = 0.19))
  datt2=lmBF(rate ~  personal_force+intention+hor_col+personal_force:hor_col+personal_force:intention+intention:hor_col +country3,  whichRandom="country3",   data=dat_long)  
  frequentist_m=lmer(rate ~ personal_force*intention*hor_col +(1|country3), data=dat_long)
  frequentist=broom.mixed::tidy(frequentist_m)
  }
datt3=as_tibble(datt/datt2)
tabledata_s2b_ind[i, "BF"]=signif(datt3[1,1],4)
tabledata_s2b_ind[i, "b"]=round(frequentist[8, "estimate"],3)
tabledata_s2b_ind[i, "p"]=round(frequentist[8, "p.value"],3)
graphdata[i, "b"]=round(frequentist[8, "estimate"],3)
graphdata[i, "lower"]=round(confint(frequentist_m),2)[10,1]
graphdata[i, "higher"]=round(confint(frequentist_m),2)[10,2]

}

graphdata=graphdata[-1,]

rownames(tabledata_s2b_ind) <- NULL

kbl(
  tabledata_s2b_ind,
  format = "latex",
  booktabs = T,
  escape=T,
  caption = "Is the interaction of personal force and intention affected by individualism/collectivism on Speedboat dilemmas when all exclusion criteria is applied?",
  centering=T,
  position="H"
  )%>%
  kable_styling( full_width = F,  position="left")%>%
  row_spec(row=0, bold=TRUE)



```




##Without any exclusions
We applied similar analysis strategy as before: we compared the full model (including the three way interaction) with a model that includes all main effects and interactions but the three-way interaction. Here, the results are somewhat fuzzier. IN the trolley dilemma, the frequentist test shows a significant effect of both country level and horizontal collectivism, but the Bayes Faktor shows the contrary; that the null effect is more likely to be true than the alternative. This comes from the differences between the two tests; the frequentists compares to the intercept, while the Bayesian to an alternative model. Even if the effect exists it cannot be generalized to the speedboat dilemmas.


<!-- Bayesian country level individualism w/o exclusion -->
```{r analysis individual + country level study 2a, echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}
#for loop changes predictor variables
#table has 5lines: country level individualism, then individual level measures

vars=c("Collectivism", "ver_ind", "hor_ind", "ver_col", "hor_col")
tabledata_s2a_ind = data.frame(variable=c("Country-level collectivism", "Vertical Individualism", "Horizontal Individualism", "Vertical Collectivism", "Horizontal Collectivism"), matrix(nrow=5, ncol=3, dimnames=list(vars,c("BF", "b",  "p"))))


dat=subset(trolley_proc,  select=c("trolley_3_rate", "trolley_4_rate", "trolley_5_rate", "trolley_6_rate", "country3", vars))
dat_long=na.omit(melt(data=dat, variable.name = "condition", value.name="rate", id.vars=c(vars, "country3")))
dat_long$personal_force = factor(ifelse(dat_long$condition=="trolley_3_rate"|dat_long$condition=="trolley_5_rate", 0, 1))
dat_long$intention = factor(ifelse(dat_long$condition=="trolley_4_rate"|dat_long$condition=="trolley_5_rate", 1, 0))
dat_long$country3=as.character(dat_long$country3)
dat_long$country3=factor(paste0("0", dat_long$country3))

graphdata=data.frame(variable=c("Country-level collectivism", "Vertical Individualism", "Horizontal Individualism", "Vertical Collectivism", "Horizontal Collectivism"), matrix(nrow=5, ncol=3, dimnames=list(vars,c("b",  "lower", "higher"))))

for (i in vars){
  if(i=="Collectivism"){
  datt=lmBF(rate ~   personal_force*intention*Collectivism + country3, data=dat_long, whichRandom="country3",rscaleCont = c("personal_force:intention:Collectivism" = 0.19))
  datt2=lmBF(rate ~  personal_force+intention+Collectivism+personal_force:Collectivism+personal_force:intention+intention:Collectivism+country3, whichRandom="country3",data=dat_long)  
  frequentist_m=lmer(rate ~ personal_force*intention*Collectivism +(1|country3), data=dat_long)
  frequentist=broom.mixed::tidy(frequentist_m)
  } else if(i=="ver_ind"){
  datt=lmBF(rate ~   personal_force*intention*ver_ind+country3, data=dat_long,  whichRandom="country3",  rscaleCont = c("personal_force:intention:ver_ind" = 0.19))
  datt2=lmBF(rate ~ personal_force+intention+ver_ind+personal_force:ver_ind+personal_force:intention+intention:ver_ind +country3,  whichRandom="country3", data=dat_long)  
  frequentist_m=lmer(rate ~ personal_force*intention*ver_ind +(1|country3), data=dat_long)
  frequentist=broom.mixed::tidy(frequentist_m)
  }else if(i=="hor_ind"){
  datt=lmBF(rate ~   personal_force*intention*hor_ind+country3, data=dat_long,  whichRandom="country3", rscaleFixed=0.26, rscaleCont = c("personal_force:intention:hor_ind" = 0.19))
  datt2=lmBF(rate ~  personal_force+intention+hor_ind+personal_force:hor_ind+personal_force:intention+intention:hor_ind+country3,  whichRandom="country3", data=dat_long)  
  frequentist_m=lmer(rate ~ personal_force*intention*hor_ind +(1|country3), data=dat_long)
  frequentist=broom.mixed::tidy(frequentist_m)
  }else if(i=="ver_col"){
  datt=lmBF(rate ~   personal_force*intention*ver_col+country3, data=dat_long,  whichRandom="country3", rscaleCont = c("personal_force:intention:ver_col" = 0.19))
  datt2=lmBF(rate ~  personal_force+intention+ver_col+personal_force:ver_col+personal_force:intention+intention:ver_col +country3,  whichRandom="country3",  data=dat_long)  
  frequentist_m=lmer(rate ~ personal_force*intention*ver_col +(1|country3), data=dat_long)
  frequentist=broom.mixed::tidy(frequentist_m)
  }else if(i=="hor_col"){
  datt=lmBF(rate ~  personal_force*intention*hor_col+country3, data=dat_long, whichRandom="country3", rscaleCont = c("personal_force:intention:hor_col" = 0.19))
  datt2=lmBF(rate ~  personal_force+intention+hor_col+personal_force:hor_col+personal_force:intention+intention:hor_col +country3,  whichRandom="country3",   data=dat_long)  
  frequentist_m=lmer(rate ~ personal_force*intention*hor_col +(1|country3), data=dat_long)
  frequentist=broom.mixed::tidy(frequentist_m)
  }
datt3=as_tibble(datt/datt2)
tabledata_s2a_ind[i, "BF"]=signif(datt3[1,1],4)
tabledata_s2a_ind[i, "b"]=round(frequentist[8, "estimate"],3)
tabledata_s2a_ind[i, "p"]=round(frequentist[8, "p.value"],3)
graphdata[i, "b"]=round(frequentist[8, "estimate"],3)
graphdata[i, "lower"]=round(confint(frequentist_m),2)[10,1]
graphdata[i, "higher"]=round(confint(frequentist_m),2)[10,2]

}

graphdata=graphdata[-1,]
rownames(tabledata_s2a_ind) <- NULL


kbl(
  tabledata_s2a_ind,
  format = "latex",
  booktabs = T,
  escape=T,
  caption = "Is the interaction of personal force and intention affected by individualism/collectivism on Trolley dilemmas?",
  centering=T,
  position="H"
  )%>%
  kable_styling( full_width = F,  position="left")%>%
  row_spec(row=0, bold=TRUE)

```


```{r study2a overall individualism plot, fig.pos="H",out.width="80%",fig.cap="Correlation between country-level individualism/collectivism and the effect of personal force in Eta sqaured on the Trolley dilemmas", echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}
##cohen d calculation for every country
#scatterplot: x effect size, y individualism
#size of dots: cohen d
countrydata=data.frame(country=levels(factor(trolley_proc$country3)), matrix(nrow=length(levels(factor(trolley_proc$country3))),ncol=3, dimnames=list(levels(factor(trolley_proc$country3)), c("cohend","Collectivism","N") )))

for (i in levels(factor(trolley_proc$country3))){
  d=subset(trolley_proc, country3==i, select=c("trolley_3_rate", "trolley_4_rate", "trolley_5_rate", "trolley_6_rate"))
  dat_long=na.omit(melt(data=d, variable.name = "condition", value.name="rate"))
  dat_long$personal_force = factor(ifelse(dat_long$condition=="trolley_3_rate"|dat_long$condition=="trolley_5_rate", 0, 1))
  dat_long$intention = factor(ifelse(dat_long$condition=="trolley_4_rate"|dat_long$condition=="trolley_5_rate", 1, 0))
  if (length(dat_long$rate)<10){
    countrydata[i,"cohend"]=NA
  }else{
    countrydata[i,"cohend"]=effectsize::eta_squared(aov(rate~intention:personal_force, data=dat_long))$Eta2
  }
  countrydata[i,"Collectivism"]=mean(trolley_proc[trolley_proc$country3==i,]$Collectivism, na.rm=T)
  countrydata[i,"N"]=length(dat_long$rate)
}

countrydata=na.omit(countrydata)
ggplot(countrydata, aes(x=cohend, y=Collectivism, label=country)) +
  geom_point(aes(size=N))+
  geom_text(hjust=-0.2,size=3)+
geom_smooth(method = "lm", mapping = aes(weight = N), color = "blue", show.legend = FALSE, se=F)+xlab("Effect size")+
  theme_bw()+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.x=element_text(face="bold", size=12, colour="Black"), axis.title.y=element_text(face="bold", size=12, colour="Black"), axis.text.x = element_text(face="bold", size=10, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_text(face="bold", size=10, colour="Black"),legend.text=element_text(size=9))
  
  

```


<!-- Bayesian personal level individualism  w/o exclusion-->
```{r study2a vertical horizontal individualism, out.width="80%", fig.cap="Personal level individualism/collectivism effects on the interaction of personal force and intention (trolley dilemmas)", echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}


ggplot(graphdata, aes(x=variable, y=b, width=0.7)) +
 geom_bar(stat="identity", position="dodge", colour="Black",  width=1.2)+
  geom_errorbar(aes(ymin=lower, ymax=higher), position=position_dodge(width=0.7), colour="Black", width=0.2) +
  labs( y="Beta effect size")+ theme_bw()+
  geom_hline(yintercept=0)+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.x=element_blank(), axis.title.y=element_text(face="bold", size=10), axis.text.x = element_text(face="bold", size=7, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_blank(),legend.text=element_text(size=9))


```



<!-- Bayesian country level individualism w/o exclusion -->
```{r analysis individual + country level study 2b, echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}
#for loop changes predictor variables
#table has 5lines: country level individualism, then individual level measures

vars=c("Collectivism", "ver_ind", "hor_ind", "ver_col", "hor_col")
tabledata_s2b_ind = data.frame(variable=c("Country-level collectivism", "Vertical Individualism", "Horizontal Individualism", "Vertical Collectivism", "Horizontal Collectivism"), matrix(nrow=5, ncol=3, dimnames=list(vars,c("BF", "b",  "p"))))

graphdata=data.frame(variable=c("Country-level collectivism", "Vertical Individualism", "Horizontal Individualism", "Vertical Collectivism", "Horizontal Collectivism"), matrix(nrow=5, ncol=3, dimnames=list(vars,c("b",  "lower", "higher"))))


dat=subset(trolley_proc,  select=c("speedboat_3_rate", "speedboat_4_rate", "speedboat_5_rate", "speedboat_6_rate", "country3", vars))
dat_long=na.omit(melt(data=dat, variable.name = "condition", value.name="rate", id.vars=c(vars, "country3")))
dat_long$personal_force = factor(ifelse(dat_long$condition=="speedboat_3_rate"|dat_long$condition=="speedboat_5_rate", 0, 1))
dat_long$intention = factor(ifelse(dat_long$condition=="speedboat_4_rate"|dat_long$condition=="speedboat_5_rate", 1, 0))
dat_long$country3=as.character(dat_long$country3)
dat_long$country3=factor(paste0("0", dat_long$country3))


for (i in vars){
  if(i=="Collectivism"){
  datt=lmBF(rate ~   personal_force*intention*Collectivism + country3, data=dat_long, whichRandom="country3",rscaleCont = c("personal_force:intention:Collectivism" = 0.19))
  datt2=lmBF(rate ~  personal_force+intention+Collectivism+personal_force:Collectivism+personal_force:intention+intention:Collectivism+country3, whichRandom="country3",data=dat_long)  
  frequentist_m=lmer(rate ~ personal_force*intention*Collectivism +(1|country3), data=dat_long)
  frequentist=broom.mixed::tidy(frequentist_m)
  } else if(i=="ver_ind"){
  datt=lmBF(rate ~   personal_force*intention*ver_ind+country3, data=dat_long,  whichRandom="country3",  rscaleCont = c("personal_force:intention:ver_ind" = 0.19))
  datt2=lmBF(rate ~ personal_force+intention+ver_ind+personal_force:ver_ind+personal_force:intention+intention:ver_ind +country3,  whichRandom="country3", data=dat_long)  
  frequentist_m=lmer(rate ~ personal_force*intention*ver_ind +(1|country3), data=dat_long)
  frequentist=broom.mixed::tidy(frequentist_m)
  }else if(i=="hor_ind"){
  datt=lmBF(rate ~   personal_force*intention*hor_ind+country3, data=dat_long,  whichRandom="country3", rscaleFixed=0.26, rscaleCont = c("personal_force:intention:hor_ind" = 0.19))
  datt2=lmBF(rate ~  personal_force+intention+hor_ind+personal_force:hor_ind+personal_force:intention+intention:hor_ind+country3,  whichRandom="country3", data=dat_long)  
  frequentist_m=lmer(rate ~ personal_force*intention*hor_ind +(1|country3), data=dat_long)
  frequentist=broom.mixed::tidy(frequentist_m)
  }else if(i=="ver_col"){
  datt=lmBF(rate ~   personal_force*intention*ver_col+country3, data=dat_long,  whichRandom="country3", rscaleCont = c("personal_force:intention:ver_col" = 0.19))
  datt2=lmBF(rate ~  personal_force+intention+ver_col+personal_force:ver_col+personal_force:intention+intention:ver_col +country3,  whichRandom="country3",  data=dat_long)  
  frequentist_m=lmer(rate ~ personal_force*intention*ver_col +(1|country3), data=dat_long)
  frequentist=broom.mixed::tidy(frequentist_m)
  }else if(i=="hor_col"){
  datt=lmBF(rate ~  personal_force*intention*hor_col+country3, data=dat_long, whichRandom="country3", rscaleCont = c("personal_force:intention:hor_col" = 0.19))
  datt2=lmBF(rate ~  personal_force+intention+hor_col+personal_force:hor_col+personal_force:intention+intention:hor_col +country3,  whichRandom="country3",   data=dat_long)  
  frequentist_m=lmer(rate ~ personal_force*intention*hor_col +(1|country3), data=dat_long)
  frequentist=broom.mixed::tidy(frequentist_m)
  }
datt3=as_tibble(datt/datt2)
tabledata_s2b_ind[i, "BF"]=signif(datt3[1,1],4)
tabledata_s2b_ind[i, "b"]=round(frequentist[8, "estimate"],3)
tabledata_s2b_ind[i, "p"]=round(frequentist[8, "p.value"],3)
graphdata[i, "b"]=round(frequentist[8, "estimate"],3)
graphdata[i, "lower"]=round(confint(frequentist_m),2)[10,1]
graphdata[i, "higher"]=round(confint(frequentist_m),2)[10,2]

}

graphdata=graphdata[-1,]

rownames(tabledata_s2b_ind) <- NULL

kbl(
  tabledata_s2b_ind,
  format = "latex",
  booktabs = T,
  escape=T,
  caption = "Is the interaction of personal force and intention affected by individualism/collectivism on Speedboat dilemmas?",
  centering=T,
  position="H"
  )%>%
  kable_styling( full_width = F,  position="left")%>%
  row_spec(row=0, bold=TRUE)



```


```{r study2b overall individualism plot, fig.pos="H",out.width="80%",fig.cap="Correlation between country-level individualism/collectivism and the interactional effect of personal force and intention in Eta squared on Speedboat dilemmas", echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}
##cohen d calculation for every country
#scatterplot: x effect size, y individualism
#size of dots: cohen d
countrydata=data.frame(country=levels(factor(trolley_proc$country3)), matrix(nrow=length(levels(factor(trolley_proc$country3))),ncol=3, dimnames=list(levels(factor(trolley_proc$country3)), c("cohend","Collectivism","N") )))

for (i in levels(factor(trolley_proc$country3))){
  d=subset(trolley_proc, country3==i, select=c("speedboat_3_rate", "speedboat_4_rate", "speedboat_5_rate", "speedboat_6_rate"))
  dat_long=na.omit(melt(data=d, variable.name = "condition", value.name="rate"))
  dat_long$personal_force = factor(ifelse(dat_long$condition=="speedboat_3_rate"|dat_long$condition=="speedboat_5_rate", 0, 1))
  dat_long$intention = factor(ifelse(dat_long$condition=="speedboat_4_rate"|dat_long$condition=="speedboat_5_rate", 1, 0))
  if (length(dat_long$rate)<10){
    countrydata[i,"cohend"]=NA
  }else{
    countrydata[i,"cohend"]=effectsize::eta_squared(aov(rate~intention:personal_force, data=dat_long))$Eta2
  }
  countrydata[i,"Collectivism"]=mean(trolley_proc[trolley_proc$country3==i,]$Collectivism, na.rm=T)
  countrydata[i,"N"]=length(dat_long$rate)
}

countrydata=na.omit(countrydata)
ggplot(countrydata, aes(x=cohend, y=Collectivism, label=country)) +
  geom_point(aes(size=N))+
  geom_text(hjust=-0.2,size=3)+
  geom_smooth(method = "lm", mapping = aes(weight = N), color = "blue", show.legend = FALSE, se=F)+
  xlab("Effect size")+
  theme_bw()+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.x=element_text(face="bold", size=12, colour="Black"), axis.title.y=element_text(face="bold", size=12, colour="Black"), axis.text.x = element_text(face="bold", size=10, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_text(face="bold", size=10, colour="Black"),legend.text=element_text(size=9))
  
  

```


<!-- Bayesian personal level individualism  w/o exclusion-->
```{r study2b vertical horizontal individualism,  out.width="80%", fig.cap="Personal level individualism/collectivism effects on the interaction of personal force and intention (speedboat dilemmas)", echo =FALSE,message=FALSE, warning=FALSE, paged.print=FALSE}


ggplot(graphdata, aes(x=variable, y=b, width=0.7)) +
 geom_bar(stat="identity", position="dodge", colour="Black",  width=1.2)+
  geom_errorbar(aes(ymin=lower, ymax=higher), position=position_dodge(width=0.7), colour="Black", width=0.2) +
  labs( y="Beta effect size")+ theme_bw()+
  geom_hline(yintercept=0)+
  theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank(),plot.title=element_text( hjust=0.5, vjust=0.5, face="bold", size=17),
        axis.title.x=element_blank(), axis.title.y=element_text(face="bold", size=10), axis.text.x = element_text(face="bold", size=7, colour="Black"), axis.text.y = element_text(face="bold", size=12, colour="Black"),
        legend.title=element_blank(),legend.text=element_text(size=9))



```

#4. Additional analysis
##Effect of physical contact and intention

In every cluster and for both types of dilemma we found good enough evidence supporting the alternative hypothesis when testing the effect of physical contact and the effect of intention. The summary of the results can be found in Table X.

```{r physical contact , echo = FALSE, message = FALSE, warning = FALSE, paged.print = FALSE}
# Tidy Bf extractor function
my_bf_extractor <- function(bf_obj) {
  BayesFactor::extractBF(bf_obj) %>% 
    tibble::rownames_to_column(var = "scale") %>% 
    dplyr::mutate(scale = stringr::str_extract(scale, "(?<=\\s)(.*)(?=\\s)"))
}

# Comparing standard footbridge with footbridge pole in every cluster
additional_res_1 <- 
  trolley_proc %>% 
  select(survey_name, survey_id, matches("trolley_[0-9]_rate|speedboat_[0-9]_rate")) %>% 
  pivot_longer(matches("_rate"), names_to = "task", names_pattern = "(.*)_rate", values_to = "rate") %>% 
  mutate(comparison = case_when(task %in% c("trolley_1", "trolley_4") ~ "trolley_physical",
                                task %in% c("speedboat_1", "speedboat_4") ~ "speedboat_physical",
                                task %in% c("trolley_3", "trolley_2") ~ "trolley_intention",
                                task %in% c("speedboat_3", "speedboat_2") ~ "speedboat_intention",
                                TRUE ~ NA_character_)) %>% 
  drop_na(rate, comparison) %>% 
  nest(data = c(survey_id, task, rate)) %>% 
  mutate(bf_res = map(data, ~ ttestBF(formula = rate ~ task, data = .x, rscale=0.26)),
         bf = map_dbl(bf_res, ~ round(my_bf_extractor(.x)$bf, 2)),
         freq_res = map(data, ~ t.test(rate ~ task, data = .x,  paired = FALSE) %>% broom::tidy()),
         t = map_dbl(freq_res, ~ round(.x$statistic, 2)),
         p = map_dbl(freq_res, ~ round(.x$p.value, 2)),
         df = map_dbl(freq_res, ~ round(.x$parameter, 2)))

additional_res_1 %>% 
  filter(str_detect(comparison, "intention|physical")) %>% 
  separate(comparison, into = c("Dilemma", "Comparison"), sep = "_") %>% 
  transmute(Cluster = str_remove(survey_name, "^[^_]*_"),
            Dilemma = str_to_title(Dilemma),
            Comparison = case_when(Comparison == "physical" ~ "Physical Contact",
                                   Comparison == "intention" ~ "Intention"),
            t,
            `Bf` = scales::scientific(bf),
            df,
            p) %>% 
  papaja::apa_table(
    caption = "Effect of Physical Contact and Intention",
    escape = TRUE)
```

##Comparing the standard switch and standard footbridge dilemmas

When comparing the standard switch and standard footbridge dilemmas in all clusters for the trolley and the speedboat tasks we found good enough evidence in every case for the support of the alternative hypothesis. The summary results of each comparison separately can be found in Table X.

```{r, standard switch and footbridge, echo = FALSE, message = FALSE, warning = FALSE, paged.print = FALSE}
additional_res_2 <- 
  trolley_proc %>% 
  select(survey_name, survey_id, matches("trolley_[0-9]_rate|speedboat_[0-9]_rate")) %>% 
  pivot_longer(matches("_rate"), names_to = "task", names_pattern = "(.*)_rate", values_to = "rate") %>% 
  mutate(comparison = case_when(task %in% c("trolley_3", "trolley_4") ~ "trolley_standard",
                                task %in% c("speedboat_3", "speedboat_4") ~ "speedboat_standard",
                                TRUE ~ NA_character_)) %>% 
  drop_na(rate, comparison) %>% 
  nest(data = c(survey_id, task, rate)) %>% 
  mutate(bf_res = map(data, ~ ttestBF(formula = rate ~ task, data = .x, rscale=0.26)),
         bf = map_dbl(bf_res, ~ round(my_bf_extractor(.x)$bf, 2)),
         freq_res = map(data, ~ t.test(rate ~ task, data = .x,  paired = FALSE) %>% broom::tidy()),
         t = map_dbl(freq_res, ~ round(.x$statistic, 2)),
         p = map_dbl(freq_res, ~ round(.x$p.value, 2)),
         df = map_dbl(freq_res, ~ round(.x$parameter, 2)))

additional_res_2 %>% 
  filter(str_detect(comparison, "standard")) %>% 
  separate(comparison, into = c("Dilemma", "Comparison"), sep = "_") %>% 
  transmute(Cluster = str_remove(survey_name, "^[^_]*_"),
            Dilemma = str_to_title(Dilemma),
            t,
            `Bf` = scales::scientific(bf),
            df,
            p) %>% 
  papaja::apa_table(
    caption = "Comparing the Standard Switch and Standard Footbridge Dilemmas",
    escape = TRUE)
```

##Oxford utilitarianism Scale

```{r}
# Prepare data for plotting
plot_data <-
  trolley_proc %>% 
  select(survey_name, lab, ResponseId, contains("oxford_")) %>%
  pivot_longer(
    contains("oxford_"),
    names_to = "item_no",
    values_to = "rate",
    names_prefix = "oxford_utilitarian_") %>%
  mutate(item_no = as.integer(item_no),
         subscale = case_when(item_no == 1L ~ "Impartial Beneficence",
                              item_no == 2L ~ "Instrumental Harm",
                              item_no == 3L ~ "Impartial Beneficence",
                              item_no == 4L ~ "Instrumental Harm",
                              item_no == 5L ~ "Impartial Beneficence",
                              item_no == 6L ~ "Instrumental Harm",
                              item_no == 7L ~ "Impartial Beneficence",
                              item_no == 8L ~ "Instrumental Harm",
                              item_no == 9L ~ "Impartial Beneficence",
                              TRUE ~ NA_character_),
         survey_name = str_remove(survey_name, "PSA006_")) %>% 
  drop_na(rate)

# Create plot
plot_data %>% 
  ggplot() +
  aes(
    x = subscale,
    y = rate,
    width = 0.7) +
  geom_boxplot() +
  facet_wrap(facets = vars(survey_name)) +
  labs(
    y = "Rating",
    x = "Subscale") +
  scale_y_continuous(
    breaks = 1:7,
    labels = as.character(1:7)) + 
  theme_bw() +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_text(hjust = 0.5, vjust = 0.5, face = "bold", size = 17),
    axis.title.x = element_blank(),
    axis.title.y = element_text(face = "bold", size = 10),
    axis.text.x = element_text(face = "bold", size = 7, colour = "Black"),
    axis.text.y = element_text(face = "bold", size = 12, colour = "Black"),
    legend.title = element_blank(),
    legend.text = element_text(size = 9))
```

#Table 1

```{r}
### Some country codes are not standard iso codes; replace
custom_countries <- 
  c("LEB" = "LBN", 
    "BUL" = "BGR", 
    "SPA" = "ESP", 
    "SWT" = "CHE",
    "PSA" = "USA")

# Transform data for the table
## Table 1 represents the countries who collected data for the study
## in the three investigated clusters
table_data <- 
  trolley_raw %>% 
  select(survey_name, lab) %>%
  drop_na(lab) %>% 
  mutate(country3 = str_extract(lab, "[A-Z]+") %>% 
              recode(., !!!custom_countries),
         region = str_remove(survey_name, "PSA006_"),
         Country = countrycode(sourcevar = country3, 
                                      origin = "iso3c",
                                      destination = "country.name"))
# GBR_001!
# Check the number of countries per region
table_data %>% 
  distinct(region, Country) %>% 
  count(region)
# Missing coutnries since the Stage 1 manuscript:
# Western: South Africa
# Southern: El Salvador
# Eastern: Indonesia

table_data <- 
  table_data %>% 
  distinct(region, Country) %>% 
  group_by(region) %>% 
  arrange(Country) %>% 
  summarise(countries = str_c(Country, collapse = ", ")) %>% 
  pivot_wider(names_from = region, values_from = countries)

# Create APA formatted table
papaja::apa_table(
  table_data,
  caption = "The Cultural Classification of Countries of Participating Labs Following Awad et al.",
  escape = TRUE
)
```

```{r, echo = FALSE}
# Check the 
```

